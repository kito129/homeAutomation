title: SelvaHome
views:
  - type: sections
    cards: []
    badges:
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: input_number.temp_out_saved
        name: Fuori
        color: purple
        icon: mdi:thermometer
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.home_temperature
        name: Sala
        icon: mdi:home-thermometer-outline
        color: ''
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.cucina_temp_temperature
        color: lime
        name: Cucina
        icon: mdi:countertop-outline
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.bagno_temp_temperature
        color: deep-orange
        name: Bagno
        icon: mdi:toilet
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.rack_temperature
        name: Sotto
        icon: mdi:sun-thermometer-outline
        color: teal
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        color: deep-orange
        entity: sensor.samba_share_cpu_percent
        tap_action:
          action: navigate
          navigation_path: '#scheduler'
        name: Scheduler
        icon: mdi:calendar-arrow-right
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        color: green
        tap_action:
          action: navigate
          navigation_path: '#automations'
        name: Auto
        icon: mdi:robot
        entity: switch.salafloor00
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        icon: mdi:chip
        color: cyan
        tap_action:
          action: navigate
          navigation_path: /config/integrations/dashboard
        entity: sensor.05kwsolar_on_duration
        name: Devices
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        entity: sensor.samba_share_newest_version
        color: amber
        tap_action:
          action: navigate
          navigation_path: /hassio/dashboard
        name: Addon
        icon: mdi:toolbox-outline
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        entity: sensor.samba_share_version
        tap_action:
          action: navigate
          navigation_path: /a0d7b954_grafana/ingress
        name: Grafana
        icon: mdi:chart-bell-curve
        color: yellow
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        entity: sensor.samba_share_version
        tap_action:
          action: navigate
          navigation_path: /ccab4aaf_frigate-fa
        name: Frigate
        icon: mdi:cctv
        color: deep-orange
    sections:
      - type: grid
        cards:
          - type: custom:bubble-card
            card_type: button
            entity: sensor.frigate_detection_fps
            button_type: state
            name: Cameras
            sub_button: []
            card_layout: large
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#cctv'
            icon: mdi:cctv
            grid_options:
              rows: 1
              columns: 12
            tap_action:
              action: navigate
              navigation_path: '#cctv'
          - type: vertical-stack
            cards:
              - type: custom:power-flow-card-plus
                entities:
                  home:
                    color_icon: true
                    entity: sensor.home_total_power_2
                    subtract_individual: false
                    override_state: true
                    secondary_info: {}
                    circle_animation: true
                  battery:
                    icon: mdi:battery-charging
                    color_circle: true
                    color_value: true
                    display_state: one_way_no_zero
                    state_of_charge: sensor.solarman_battery_voltage
                    invert_state: false
                    show_state_of_charge: true
                    color_state_of_charge_value: true
                    state_of_charge_unit_white_space: false
                    state_of_charge_unit: V
                    state_of_charge_decimals: 1
                    entity: sensor.solarman_battery_power
                    display_zero_tolerance: 50
                  grid:
                    name: Enel
                    color_icon: true
                    entity: sensor.enel_power
                    use_metadata: false
                    display_state: one_way_no_zero
                  solar:
                    color_icon: true
                    display_zero_state: false
                    color_value: false
                    display_zero_tolerance: 20
                    secondary_info:
                      entity: sensor.solarman_pv1_power
                      display_zero: false
                      display_zero_tolerance: 20
                    entity: sensor.solar_power
                  individual:
                    - entity: sensor.boiler_room_power
                      icon: mdi:hydraulic-oil-level
                      color: '#5de882'
                      name: Boiler Room
                      color_icon: true
                      display_zero_tolerance: 5
                    - entity: sensor.ac_total_power
                      name: AC
                      color_icon: true
                      color:
                        - 245
                        - 0
                        - 0
                      icon: mdi:air-conditioner
                      display_zero_tolerance: 10
                      color_value: true
                      inverted_animation: false
                      use_metadata: false
                    - entity: sensor.kitchen_power
                      name: Kitchen
                      color_icon: true
                      color:
                        - 172
                        - 32
                        - 223
                      icon: mdi:toaster-oven
                      display_zero_tolerance: 10
                    - entity: sensor.fan_power
                      name: 'Bagno '
                      icon: mdi:heating-coil
                      color_icon: true
                      color:
                        - 252
                        - 255
                        - 51
                      secondary_info: {}
                  fossil_fuel_percentage:
                    state_type: power
                    unit_white_space: false
                w_decimals: 0
                kw_decimals: 2
                min_flow_rate: 0.9
                display_zero_lines:
                  mode: hide
                  transparency: 51
                  grey_color:
                    - 226
                    - 36
                    - 0
                max_flow_rate: 10
                min_expected_power: 1
                max_expected_power: 5000
                watt_threshold: 1000
                clickable_entities: true
                use_new_flow_rate_model: false
                disable_dots: false
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Inverter
            icon: mdi:amplifier
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#inverter'
            sub_button:
              - entity: sensor.solarman_daily_total_energy
                icon: mdi:amplifier
                show_name: false
                show_state: true
                visibility:
                  - condition: numeric_state
                    entity: sensor.solarman_daily_total_energy
                    above: 0.5
              - name: ''
                icon: mdi:home
                tap_action:
                  action: navigate
                  navigation_path: '#inverter-charts'
                show_name: false
                entity: sensor.inverter_nord_to_home_power
                show_state: true
                visibility:
                  - condition: numeric_state
                    above: 50
                    entity: sensor.inverter_nord_to_home_power
            tap_action:
              action: navigate
              navigation_path: '#inverter'
            entity: sensor.solarman_grid_connected_status
          - type: custom:bubble-card
            card_type: button
            button_type: state
            entity: sensor.batterie_garage_voltmeter
            name: Inverter Garage
            icon: mdi:garage-open-variant
            sub_button:
              - entity: sensor.casa_nonna_power
                show_last_changed: false
                show_state: true
                visibility:
                  - condition: numeric_state
                    entity: sensor.casa_nonna_power
                    above: 5
              - entity: sensor.nonna_temp_temperature
                show_last_changed: false
                show_state: true
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#inverter-garage'
            tap_action:
              action: navigate
              navigation_path: '#inverter-garage'
          - type: custom:bubble-card
            card_type: button
            entity: update.simple_weather_card_update
            button_type: state
            name: Meteo
            sub_button: []
            card_layout: large
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#weather'
            grid_options:
              columns: 6
              rows: 1
            tap_action:
              action: navigate
              navigation_path: '#weather'
            show_state: false
            icon: mdi:weather-cloudy-clock
          - type: custom:bubble-card
            card_type: button
            button_type: name
            name: 'Temperature '
            icon: mdi:home-thermometer-outline
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#home-temp'
              double_tap_action:
                action: navigate
                navigation_path: '#home-temp'
            grid_options:
              columns: 6
              rows: 1
            tap_action:
              action: navigate
              navigation_path: '#home-temp'
          - type: energy-distribution
            link_dashboard: true
      - type: grid
        cards:
          - type: heading
            heading: Riscaldamento
            heading_style: title
            icon: mdi:heat-wave
            badges:
              - type: entity
                entity: sensor.home_temperature
              - type: entity
                entity: sensor.home_humidity
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Ac Sala
            icon: mdi:air-conditioner
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#ac-sala'
            sub_button:
              - entity: sensor.acsala_power
                show_state: true
                show_attribute: false
                visibility:
                  - condition: numeric_state
                    entity: sensor.ac_total_power
                    above: 50
              - entity: sensor.delta_temp
                show_state: true
                icon: mdi:delta
                visibility:
                  - condition: state
                    entity: binary_sensor.ac_sala_function
                    state: 'on'
            tap_action:
              action: navigate
              navigation_path: '#ac-sala'
            entity: climate.ac_sala_wifi
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Ac Scala
            icon: mdi:air-conditioner
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#ac-scala'
            sub_button:
              - entity: sensor.acscala_power
                show_state: true
                show_attribute: false
                visibility:
                  - condition: numeric_state
                    entity: sensor.acscala_power
                    above: 50
            tap_action:
              action: navigate
              navigation_path: '#ac-scala'
            entity: binary_sensor.ac_scala_function
          - type: heading
            heading_style: title
            heading: Bagno
            icon: mdi:shower-head
            badges:
              - type: entity
                entity: sensor.bagno_temp_temperature
              - type: entity
                entity: sensor.bagno_temp_humidity
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Bagno
            icon: mdi:heating-coil
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#bagno'
            sub_button:
              - entity: sensor.fan_power
                show_last_changed: false
                show_state: true
                visibility:
                  - condition: state
                    entity: switch.fan
                    state: 'on'
            entity: switch.fan
            tap_action:
              action: navigate
              navigation_path: '#bagno'
          - type: heading
            heading: Boiler Room
            heading_style: title
            icon: mdi:pipe
            badges:
              - type: entity
                entity: sensor.rack_temperature
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Boiler
            icon: mdi:water-boiler
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#boiler'
            sub_button:
              - show_state: true
                show_attribute: false
                visibility:
                  - condition: numeric_state
                    entity: sensor.ac_total_power
                    above: 50
                entity: sensor.boiler_status
              - entity: sensor.boiler_power
                show_name: false
                show_state: true
                visibility:
                  - condition: numeric_state
                    entity: sensor.boiler_power
                    above: 50
            tap_action:
              action: navigate
              navigation_path: '#boiler'
            entity: sensor.boiler_status
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Lavatrice
            icon: mdi:washing-machine
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#lavatrice'
            sub_button:
              - show_state: true
                show_attribute: false
                visibility:
                  - condition: numeric_state
                    entity: sensor.washmachine_power
                    above: 50
                entity: sensor.front_load_washer_current_course
                name: Prog
                show_name: true
                icon: mdi:progress-check
              - entity: sensor.washmachine_power
                show_name: false
                show_state: true
                visibility:
                  - condition: numeric_state
                    entity: sensor.washmachine_power
                    above: 20
            tap_action:
              action: navigate
              navigation_path: '#lavatrice'
            entity: sensor.front_load_washer
          - type: heading
            heading: Cucina
            heading_style: title
            icon: mdi:countertop-outline
            badges:
              - type: entity
                entity: sensor.cucina_temp_temperature
              - type: entity
                entity: sensor.cucina_temp_humidity
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Lavastoviglie
            icon: mdi:dishwasher
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#lavastoviglie'
            sub_button:
              - entity: sensor.washdisher_power
                show_name: false
                show_state: true
                visibility:
                  - condition: numeric_state
                    entity: sensor.washdisher_power
                    above: 50
              - show_state: true
                show_attribute: false
                visibility:
                  - condition: state
                    entity: switch.dishwasher_power
                    state: 'on'
                entity: sensor.dishwasher_program_progress
                icon: mdi:percent-outline
            tap_action:
              action: navigate
              navigation_path: '#lavastoviglie'
            entity: switch.dishwasher_power
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Frigo
            icon: mdi:fridge
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#frigo'
            sub_button:
              - show_state: true
                show_attribute: false
                visibility:
                  - condition: state
                    entity: binary_sensor.frigo_state
                    state: 'on'
                entity: sensor.frigo_power
                name: Power
                show_name: true
                icon: mdi:lightning-bolt
            tap_action:
              action: navigate
              navigation_path: '#frigo'
            entity: binary_sensor.frigo_state
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Forno
            icon: mdi:stove
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#forno'
            sub_button:
              - show_state: true
                show_attribute: false
                visibility:
                  - condition: state
                    entity: binary_sensor.fornostate
                    state: 'on'
                entity: sensor.forno_power
                name: Power
                show_name: true
                icon: mdi:lightning-bolt
            tap_action:
              action: navigate
              navigation_path: '#forno'
            entity: binary_sensor.fornostate
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    icon: mdi:ceiling-light
                    icon_color: yellow
                    name: 'Sala '
                    entity: switch.salafloor00
                    double_tap_action:
                      action: toggle
                    layout: vertical
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    icon: mdi:lightbulb-group
                    icon_color: light-green
                    name: 'Lampade '
                    entity: switch.lampadeout
                    double_tap_action:
                      action: toggle
                    fill_container: false
                    layout: vertical
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    entity: switch.ledentrata
                    name: 'Entrata '
                    icon: mdi:led-on
                    icon_color: red
                    double_tap_action:
                      action: toggle
                    layout: vertical
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    icon: mdi:lightbulb
                    icon_color: green
                    entity: switch.backled
                    name: Legnaia
                    double_tap_action:
                      action: toggle
                    layout: vertical
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    icon: mdi:light-flood-down
                    icon_color: light-blue
                    entity: switch.ledswitchnorth
                    name: 'Switch '
                    double_tap_action:
                      action: toggle
                    layout: vertical
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    icon: mdi:lightbulb-group-outline
                    icon_color: deep-orange
                    name: 'Tutte le luci '
                    entity: switch.lights
                    double_tap_action:
                      action: toggle
                    layout: vertical
                    secondary_info: none
                columns: 3
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-light-card
                entity: light.sala_2
                use_light_color: true
                show_brightness_control: true
                show_color_control: false
                show_color_temp_control: true
                collapsible_controls: true
                tap_action:
                  action: more-info
                hold_action:
                  action: more-info
                icon: mdi:ceiling-light
                icon_color: lime
                double_tap_action:
                  action: toggle
              - type: custom:mushroom-light-card
                entity: light.led_1
                use_light_color: true
                show_brightness_control: true
                show_color_control: false
                show_color_temp_control: true
                collapsible_controls: true
                tap_action:
                  action: more-info
                icon_color: teal
                double_tap_action:
                  action: toggle
                name: Camera Est
            columns: 2
          - type: custom:bar-card
            style: |-
              bar-card-value {
                margin-right: auto;
                font-size: 20px;
                font-weight: bold;
                text-shadow: 1px 1px #0005;
              }
            positions:
              indicator: outside
              name: inside
            animation:
              state: 'true'
              speed: 3
            severity:
              - color: Orange
                from: 650
                to: 1200
              - color: Red
                from: 1200
                to: 2000
              - color: Green
                from: 0
                to: 850
              - hide: null
                from: -5
                to: 5
            entities:
              - entity: sensor.home_other_loads_power
                name: Home altri carichi
                max: '1800'
                icon: mdi:home
              - entity: sensor.inverter_nord_to_home_power
                name: Inverter -> Casa
                max: '1800'
                icon: mdi:amplifier
          - type: history-graph
            entities:
              - entity: switch.ininverter
                name: Battery In
              - entity: switch.sw1
                name: Battery A
              - entity: switch.sw2
                name: Battery B
              - entity: switch.ininverter
                name: OnGrid
              - entity: binary_sensor.ac_sala_function
                name: Sala
              - entity: binary_sensor.ac_scala_function
                name: Scala
              - entity: switch.fan
                name: Bagno
              - entity: sensor.boiler_status
                name: Boiler
              - entity: select.dishwasher_active_program
                name: Lavastoviglie
              - entity: binary_sensor.frigo_state
                name: Frigo
              - entity: sensor.front_load_washer
                name: Lavatrice
            hours_to_show: 16
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: vertical-stack
                cards:
                  - type: energy-devices-graph
                    max_devices: 7
          - type: energy-usage-graph
          - type: vertical-stack
            cards:
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    name: Network
                    icon: mdi:network-pos
                    icon_color: yellow
                    double_tap_action:
                      action: none
                    layout: horizontal
                    entity: switch.acsala
                    hold_action:
                      action: none
                    tap_action:
                      action: navigate
                      navigation_path: '#network'
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    name: Pi
                    icon: mdi:server-minus
                    icon_color: accent
                    double_tap_action:
                      action: none
                    layout: horizontal
                    entity: switch.acsala
                    hold_action:
                      action: none
                    tap_action:
                      action: navigate
                      navigation_path: '#pi'
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    name: Energy
                    icon: mdi:home-lightning-bolt
                    icon_color: green
                    double_tap_action:
                      action: none
                    layout: horizontal
                    entity: switch.acsala
                    hold_action:
                      action: none
                    tap_action:
                      action: navigate
                      navigation_path: '#energy'
                    secondary_info: none
                  - type: custom:mushroom-entity-card
                    name: Shelly
                    icon: mdi:switch
                    icon_color: light-blue
                    double_tap_action:
                      action: none
                    layout: horizontal
                    entity: switch.acsala
                    hold_action:
                      action: none
                    tap_action:
                      action: navigate
                      navigation_path: '#shelly'
                    secondary_info: none
                columns: 2
          - type: custom:mini-graph-card
            title: Inverter
            entities:
              - entity: sensor.solar_power
                name: Sud
              - entity: sensor.solarman_pv1_power
                name: Nord
              - entity: sensor.enel_power
                name: Enel
                color: green
            color_thresholds:
              - value: 500
                color: '#395ce6'
              - color: '#cce639'
              - value: 2500
                color: '#ff0000'
            hours_to_show: 16
            points_per_hour: 12
            line_width: 4
            font_size: 120
            animate: true
            height: 230
            cache: true
            show:
              name: true
              extrema: true
              icon: false
              state: false
              legend: true
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#lavastoviglie'
                name: Lavastoviglie
                icon: mdi:dishwasher
                card_layout: large
                button_type: state
                entity: sensor.dishwasher_operation_state
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.dishwasher_power
                    icon: mdi:power
                    primary_info: state
                    secondary_info: name
                    name: Power
                    icon_color: purple
                    layout: vertical
                  - type: custom:mushroom-select-card
                    entity: select.dishwasher_active_program
                    name: Programma
                    icon_color: red
                    fill_container: false
                columns: 2
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1200
                  - color: Red
                    from: 1200
                    to: 2000
                  - color: Green
                    from: 0
                    to: 850
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.washdisher_power
                    name: Lavastoviglie
                    max: '1800'
                    icon: mdi:dishwasher
              - type: history-graph
                entities:
                  - entity: switch.dishwasher_power
                    name: 'On'
                  - entity: sensor.dishwasher_operation_state
                    name: Status
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.washdisher_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.lavastoviglie_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.lavastoviglie_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.lavastoviglie_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.lavastoviglie_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 3 ? "darkred" : 
                                 value > 2? "red" : 
                                 value > 1 ? "darkorange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.lavastoviglie_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#lavatrice'
                name: Lavatrice
                icon: mdi:washing-machine
                card_layout: large
                button_type: state
                entity: sensor.front_load_washer_current_course
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bubble-card
                card_type: button
                button_type: state
                tap_action:
                  action: navigate
                  navigation_path: '#kitchen'
                sub_button: []
                button_action:
                  double_tap_action:
                    action: toggle
                name: Power
                icon: mdi:power
                show_attribute: false
                show_last_changed: true
                entity: switch.washmachine
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.front_load_washer_current_course
                sub_button:
                  - entity: sensor.front_load_washer_remaining_time
                    name: Remain
                    show_name: true
                    show_state: true
                    icon: mdi:magic-staff
                  - entity: sensor.front_load_washer_spin_speed
                    show_state: true
                    show_name: true
                    name: Speed
                    icon: mdi:speedometer
                name: Programma
              - type: custom:bubble-card
                card_type: select
                entity: select.washer_course_selection
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1200
                  - color: Red
                    from: 1200
                    to: 2000
                  - color: Green
                    from: 0
                    to: 850
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.washmachine_power
                    name: Lavatrice
                    max: '1800'
                    icon: mdi:washing-machine
              - type: history-graph
                entities:
                  - entity: sensor.front_load_washer
                    name: 'On'
                  - entity: sensor.front_load_washer_current_course
                    name: Status
                hours_to_show: 16
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.washmachine_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.washmachine_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.washmachine_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.washmachine_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.washmachine_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 3 ? "darkred" : 
                                 value > 2? "red" : 
                                 value > 1 ? "darkorange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.washmachine_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#forno'
                name: Forno
                icon: mdi:stove
                card_layout: large
                button_type: state
                entity: binary_sensor.fornostate
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bubble-card
                card_type: button
                button_type: state
                tap_action:
                  action: navigate
                  navigation_path: '#kitchen'
                sub_button:
                  - entity: sensor.forno_on_duration
                    name: Duration
                    show_last_changed: false
                    show_state: true
                    show_name: true
                button_action:
                  double_tap_action:
                    action: toggle
                name: Power
                icon: mdi:power
                show_attribute: false
                show_last_changed: true
                entity: binary_sensor.fornostate
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1200
                  - color: Red
                    from: 1200
                    to: 2000
                  - color: Green
                    from: 0
                    to: 850
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.forno_power
                    name: Forno
                    max: '1800'
                    icon: mdi:stove
              - type: history-graph
                entities:
                  - entity: binary_sensor.fornostate
                    name: 'On'
                hours_to_show: 16
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.forno_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.forno_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.forno_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.forno_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.forno_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 3 ? "darkred" : 
                                 value > 1 ? "darkorange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.forno_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#frigo'
                name: Frigo
                icon: mdi:fridge
                card_layout: large
                button_type: state
                entity: binary_sensor.frigo_state
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bubble-card
                card_type: button
                button_type: state
                tap_action:
                  action: navigate
                  navigation_path: '#kitchen'
                sub_button:
                  - entity: sensor.frigo_on_duration
                    name: Duration
                    show_last_changed: false
                    show_state: true
                    show_name: true
                button_action:
                  double_tap_action:
                    action: toggle
                name: Power
                icon: mdi:power
                show_attribute: false
                show_last_changed: true
                entity: binary_sensor.frigo_state
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 90
                    to: 1200
                  - color: Green
                    from: 0
                    to: 90
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.frigo_power
                    name: Frigo
                    max: '150'
                    icon: mdi:fridge
              - type: history-graph
                entities:
                  - entity: binary_sensor.frigo_state
                    name: 'On'
                hours_to_show: 16
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.frigo_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.frigo_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.frigo_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.frigo_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.frigo_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 0.85 ? "darkred" : 
                                 value > 0.5 ? "orange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.frigo_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#bagno'
                name: Bagno
                icon: mdi:heating-coil
                card_layout: large
                button_type: state
                entity: switch.fan
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Red
                    from: 400
                    to: 2000
                  - color: Green
                    from: 0
                    to: 399
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.fan_power
                    name: Bagno
                    max: '500'
                    icon: mdi:heating-coil
              - type: history-graph
                entities:
                  - entity: switch.fan
                    name: 'On'
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.fan_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.fan_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.fan_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.fan_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.fan_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - filter: y > 0
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 4 ? "darkred" : 
                                 value > 3 ? "red" : 
                                 value > 2 ? "darkorange" : 
                                 value > 1 ? "orange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.fan_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - filter: y > 0
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#boiler'
                name: Boiler
                icon: mdi:water-boiler
                card_layout: large
                button_type: state
                entity: sensor.boiler_status
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bubble-card
                card_type: button
                button_type: state
                tap_action:
                  action: navigate
                  navigation_path: '#kitchen'
                sub_button: []
                button_action:
                  double_tap_action:
                    action: toggle
                name: Power
                icon: mdi:power
                show_attribute: false
                show_last_changed: true
                entity: switch.boiler
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.boiler_total_on_duration
                sub_button:
                  - entity: sensor.boiler_heat_pump_duration
                    name: P
                    show_name: true
                    show_state: true
                    icon: mdi:pump
                  - entity: sensor.boiler_pump_resistance_duration
                    show_state: true
                    show_name: true
                    name: P & R
                    icon: mdi:air-filter
                  - entity: sensor.boiler_resistance_duration
                    show_state: true
                    show_name: true
                    name: R
                    icon: mdi:resistor
                name: Duration
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1200
                  - color: Red
                    from: 1200
                    to: 2000
                  - color: Green
                    from: 0
                    to: 850
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.boiler_power
                    name: Boiler
                    max: '1800'
                    icon: mdi:water-boiler
              - type: history-graph
                entities:
                  - entity: switch.boiler
                    name: 'On'
                  - entity: sensor.boiler_status
                    name: Status
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.boiler_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.boiler_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.boiler_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.boiler_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.boiler_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 4 ? "darkred" : 
                                 value > 3? "red" : 
                                 value > 2 ? "darkorange" : 
                                 value > 6 ? "orange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.boiler_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#ac-sala'
                name: AC Sala
                icon: mdi:air-conditioner
                card_layout: large
                button_type: state
                entity: binary_sensor.ac_sala_function
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bubble-card
                card_type: climate
                entity: climate.ac_sala_wifi
                sub_button:
                  - name: HVAC modes menu
                    select_attribute: hvac_modes
                    state_background: false
                    show_arrow: false
                  - entity: climate.ac_sala_wifi
                    select_attribute: preset_modes
                    name: 'Presets '
                show_attribute: false
                attribute: preset_modes
                card_layout: large
                name: Sala
                icon: mdi:air-conditioner
                state_color: true
              - type: custom:bubble-card
                card_type: button
                button_type: state
                tap_action:
                  action: navigate
                  navigation_path: '#kitchen'
                entity: switch.ac_sala_wifi_high_power_mode
                sub_button: []
                button_action:
                  double_tap_action:
                    action: toggle
                name: Hi Power
                icon: mdi:fire-circle
                show_attribute: false
                show_last_changed: true
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1200
                  - color: Red
                    from: 1200
                    to: 2000
                  - color: Green
                    from: 0
                    to: 850
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.acsala_power
                    name: Sala
                    max: '1800'
                    icon: mdi:air-conditioner
              - type: history-graph
                entities:
                  - entity: binary_sensor.ac_sala_function
                    name: 'On'
                  - entity: switch.ac_sala_wifi_high_power_mode
                    name: Hi
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.acsala_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                title: Temperature
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: red
                    icon: ''
                    entity: input_number.temp2previuous
                    name: Mandata
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: light-blue
                    entity: input_number.temp1previous
                    icon: ''
                    name: Ritorno
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: lime
                    icon: mdi:delta
                    entity: sensor.delta_temp
                    name: Delta
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: green
                    entity: input_number.temp_out_saved
                    name: Out
                    icon: mdi:temperature-celsius
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: white
                    icon: mdi:current-ac
                    entity: sensor.acsala_voltage
                    name: Voltage
                columns: 3
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.temperature1
                    name: Ritorno
                  - entity: sensor.temperature2
                    name: Mandata
                  - entity: sensor.delta_temp
                    name: Delta
                title: AC Temp
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 4
                          step: day
                        - count: 10
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    icon: mdi:battery-negative
                    entity: sensor.acsala_energy
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    icon: mdi:battery-negative
                    entity: sensor.acsala_energy
                    name: Week
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    icon: mdi:battery-negative
                    entity: sensor.acsala_energy
                    name: Month
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.acsala_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 14 ? "darkred" : 
                                 value > 12 ? "red" : 
                                 value > 10? "darkorange" : 
                                 value > 5 ? "orange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.acsala_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#ac-scala'
                name: AC Scala
                icon: mdi:air-conditioner
                card_layout: large
                button_type: state
                entity: binary_sensor.ac_scala_function
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1200
                  - color: Red
                    from: 1200
                    to: 2000
                  - color: Green
                    from: 0
                    to: 850
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.acscala_power
                    name: Scala
                    max: '1800'
                    icon: mdi:air-conditioner
              - type: history-graph
                entities:
                  - entity: binary_sensor.ac_scala_function
                    name: 'On'
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.acscala_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    icon: mdi:battery-negative
                    entity: sensor.acscala_energy
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    icon: mdi:battery-negative
                    entity: sensor.acscala_energy
                    name: Week
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    icon: mdi:battery-negative
                    entity: sensor.acscala_energy
                    name: Month
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.acscala_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 8 ? "darkred" : 
                                 value > 6 ? "red" : 
                                 value > 4? "darkorange" : 
                                 value > 3 ? "orange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.acscala_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#inverter'
                name: Inverter
                icon: mdi:electron-framework
                card_layout: large
                button_type: state
                entity: sensor.solarman_battery_voltage
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: false
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 0px
              - type: custom:bubble-card
                card_type: button
                entity: switch.sw1
                name: Charts
                icon: mdi:chart-areaspline
                sub_button: []
                button_type: name
                tap_action:
                  action: none
                button_action:
                  tap_action:
                    action: navigate
                    navigation_path: '#inverter-charts'
              - type: custom:sunsynk-power-flow-card
                cardstyle: lite
                show_solar: true
                battery:
                  show_daily: true
                  max_power: 2000
                  auto_scale: true
                  show_absolute: false
                  dynamic_colour: true
                  animate: false
                  show_remaining_energy: false
                  hide_soc: true
                  count: 1
                  invert_power: false
                  remaining_energy_to_shutdown: false
                  shutdown_soc: 20
                  shutdown_soc_offgrid: 20
                  soc_end_of_charge: 90
                solar:
                  show_daily: true
                  mppts: 1
                  dynamic_colour: true
                  pv1_max_power: 3000
                  max_power: 3000
                  invert_flow: false
                  colour:
                    - 254
                    - 251
                    - 65
                  pv1_name: Nord
                load:
                  show_daily: true
                  load1_icon: ''
                  auto_scale: true
                  invert_load: false
                  dynamic_colour: true
                  dynamic_icon: true
                  colour:
                    - 54
                    - 176
                    - 101
                  off_colour:
                    - 115
                    - 115
                    - 115
                  max_power: 2000
                  label_daily_load: Batt + Solar
                  show_aux: false
                  aux_name: Ac
                grid:
                  show_daily_buy: false
                  show_daily_sell: true
                  show_nonessential: false
                  grid_name: Casa
                  label_daily_grid_buy: Comprata casa
                  label_daily_grid_sell: Solar to Home
                  additional_loads: 1
                  nonessential_icon: mdi:air-conditioner
                  invert_grid: true
                  nonessential_name: Ac
                  off_threshold: 10
                  grid_off_colour:
                    - 173
                    - 173
                    - 173
                  disconnected_icon: mdi:home
                  import_icon: mdi:home
                  export_icon: mdi:home
                  invert_flow: true
                entities:
                  use_timer_248: switch.solarman_toggle_system_timer
                  inverter_voltage_154: sensor.solarman_grid_voltage_l1
                  load_frequency_192: sensor.solarman_load_frequency
                  inverter_current_164: sensor.solarman_current_l1
                  inverter_power_175: sensor.solarman_micro_inverter_power
                  grid_connected_status_194: binary_sensor.solarman_grid_status
                  inverter_status_59: sensor.solarman_status_connection
                  day_battery_charge_70: sensor.solarman_daily_battery_charge
                  day_battery_discharge_71: sensor.solarman_daily_battery_discharge
                  battery_voltage_183: sensor.solarman_battery_voltage
                  battery_soc_184: sensor.solarman_battery_soc
                  battery_power_190: sensor.solarman_battery_power
                  battery_current_191: sensor.solarman_battery_current
                  grid_power_169: sensor.solarman_total_grid_power
                  day_grid_import_76: sensor.solarman_daily_energy_bought
                  day_grid_export_77: sensor.solarman_daily_total_consumption
                  day_load_energy_84: sensor.solarman_daily_total_energy
                  essential_power: sensor.battery_out_power
                  aux_power_166: sensor.solarman_total_load_power
                  day_pv_energy_108: sensor.solarman_daily_production
                  pv1_power_186: sensor.solarman_pv1_power
                  pv2_power_187: sensor.solarman_pv2_power
                  pv1_voltage_109: sensor.solarman_pv1_voltage
                  pv1_current_110: sensor.solarman_pv1_current
                  pv2_voltage_111: sensor.solarman_pv2_voltage
                  pv2_current_112: sensor.solarman_pv2_current
                  battery_temp_182: sensor.solarman_battery_temperature
                  battery_rated_capacity: '200'
                  battery_status: sensor.solarman_battery_status
                  total_pv_generation: sensor.solarman_total_production
                  grid_ct_power_total: sensor.solarman_total_grid_power
                  dc_transformer_temp_90: sensor.solarman_dc_temperature
                  grid_ct_power_172: sensor.solarman_internal_ct_l1_power
                  grid_voltage: sensor.enel_voltage
                  load_power_L1: sensor.solarman_load_l1_power
                  aux_connected_status: sensor.solarman_grid_connected_status
                inverter:
                  model: deye
                  modern: true
                  auto_scale: true
                  autarky: 'no'
                  three_phase: false
                large_font: true
                wide: false
                show_battery: true
                show_grid: true
                decimal_places: 1
                decimal_places_energy: 1
                dynamic_line_width: true
                card_height: '600'
                battery2:
                  hide_soc: false
                  soc_end_of_charge: sensor.battery_self_used_percent
                  remaining_energy_to_shutdown: false
                  show_remaining_energy: true
                title_size: '3'
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-template-card
                    primary: A - Sala
                    secondary: >-
                      {{is_state('switch.sw1', "on")  | iif("Inverter", "Enel")
                      }}
                    icon: >
                      {{ is_state('switch.sw1', "on")  |
                      iif("mdi:electric-switch-closed", "mdi:electric-switch")
                      }}
                    entity: switch.sw1
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: ''
                    badge_color: ''
                    color: |
                      {{ is_state('switch.sw1', "on") | iif("blue", "yellow") }}
                    features_position: bottom
                  - type: custom:mushroom-template-card
                    primary: B - Scala
                    secondary: >-
                      {{is_state('switch.sw2', "on")  | iif("Inverter", "Enel")
                      }}
                    icon: >
                      {{ is_state('switch.sw2', "on") |
                      iif("mdi:electric-switch-closed", "mdi:electric-switch")
                      }}
                    entity: switch.sw2
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: ''
                    badge_color: ''
                    color: |
                      {{ is_state('switch.sw2', "on") | iif("blue", "yellow") }}
                    features_position: bottom
                columns: 2
              - type: custom:mushroom-template-card
                primary: >-
                  {{is_state('switch.ininverter', "on")  | iif("On Grid", "Off
                  Grid") }}
                secondary: Grid
                icon: >
                  {{ is_state('switch.ininverter', "on") |
                  iif("mdi:electric-switch-closed", "mdi:electric-switch") }}
                entity: switch.ininverter
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: ''
                badge_color: ''
                color: >
                  {{ is_state('switch.ininverter', "on") | iif("red", "white")
                  }}
                vertical: true
                features_position: bottom
              - square: false
                type: grid
                cards:
                  - type: history-graph
                    entities:
                      - entity: switch.sw1
                        name: Sala
                      - entity: switch.sw2
                        name: Scala
                      - entity: switch.ininverter
                        name: GRID
                    hours_to_show: 12
                  - type: entities
                    entities:
                      - entity: input_number.kwh_to_turn_on_switch
                        name: Soglia produzione ON
                      - entity: input_number.battery_cut_off
                        name: Tensione OFF
                      - entity: input_number.autoconsumo_cut_off
                        name: Autoconsumo OFF
                      - entity: sensor.battery_self_used_percent
                        name: Autoconsumo
                    title: Battery Setting
                    state_color: true
                  - type: entities
                    entities:
                      - entity: automation.accendi_se_caricato_x
                        secondary_info: last-triggered
                        name: Produzione Soglia ON
                        icon: mdi:solar-power-variant
                      - entity: automation.battery_off_at_soc_level
                        name: Battery OFF  a Tensione OFF
                        secondary_info: last-triggered
                        icon: mdi:battery-10
                      - entity: automation.battery_autoconsumo
                        secondary_info: last-triggered
                        name: Autonconsumo OFF
                        icon: mdi:home-battery-outline
                      - entity: automation.midday_soc_on_ongrid
                        secondary_info: last-triggered
                        name: OnGrid ON se carico a 1/2 day
                        icon: mdi:battery-charging-80
                columns: 1
                view_layout:
                  position: sidebar
              - type: gauge
                entity: sensor.solarman_battery_voltage
                name: Battery V
                needle: true
                severity:
                  green: 46
                  yellow: 48
                  red: 51
                min: 46
                max: 56
                unit: V
                view_layout:
                  position: sidebar
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: min
                    entity: sensor.solarman_battery_voltage
                    name: Min
                    unit: V
                    icon: mdi:battery-40
                    view_layout:
                      position: sidebar
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: mean
                    entity: sensor.solarman_battery_voltage
                    name: Avg
                    unit: V
                    view_layout:
                      position: sidebar
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: max
                    entity: sensor.solarman_battery_voltage
                    name: Max
                    unit: V
                    view_layout:
                      position: sidebar
                columns: 3
                view_layout:
                  position: sidebar
              - type: custom:bubble-card
                card_type: button
                entity: switch.sw1
                name: Charts
                icon: mdi:chart-areaspline
                sub_button: []
                button_type: name
                tap_action:
                  action: none
                button_action:
                  tap_action:
                    action: navigate
                    navigation_path: '#inverter-charts'
              - type: vertical-stack
                cards:
                  - chart_type: bar
                    period: day
                    type: statistics-graph
                    entities:
                      - sensor.solarman_total_battery_charge
                      - sensor.solarman_total_battery_discharge
                    days_to_show: 30
                    fit_y_data: false
                    hide_legend: false
                    title: Battery Energy
                    stat_types:
                      - change
                  - type: custom:mini-graph-card
                    title: Inverter
                    entities:
                      - entity: sensor.solarman_pv1_power
                        name: Nord
                    color_thresholds:
                      - value: 300
                        color: '#395ce6'
                      - color: '#cce639'
                      - value: 1600
                        color: '#ff0000'
                    hours_to_show: 16
                    points_per_hour: 12
                    line_width: 4
                    font_size: 120
                    animate: true
                    height: 230
                    cache: true
                    show:
                      name: true
                      extrema: true
                      icon: false
                      state: false
                      legend: true
                  - type: custom:mini-graph-card
                    title: Inverter
                    entities:
                      - entity: sensor.solarman_battery_voltage
                        name: Battery Voltage
                    color_thresholds:
                      - value: 48
                        color: '#395ce6'
                      - color: '#cce639'
                      - value: 54
                        color: '#ff0000'
                    hours_to_show: 16
                    points_per_hour: 12
                    line_width: 4
                    font_size: 120
                    animate: true
                    height: 230
                    cache: true
                    show:
                      name: true
                      extrema: true
                      icon: false
                      state: false
                      legend: true
                  - type: custom:plotly-graph
                    entities:
                      - entity: sensor.solarman_daily_battery_charge
                        fill: tozeroy
                      - entity: sensor.solarman_daily_battery_discharge
                        fill: tozeroy
                      - entity: sensor.solarman_battery_soc
                    title: Battery
                    logarithmic_scale: false
                    hours_to_show: 16
                    refresh_interval: 10
                    autorange_after_scroll: true
                    layout:
                      height: 500
                      type: bar
                      xaxis:
                        rangeselector:
                          'y': 1.2
                          buttons:
                            - count: 3
                              step: hour
                            - count: 16
                              step: hour
                            - count: 36
                              step: hour
                            - count: 5
                              step: day
                  - type: custom:mini-graph-card
                    title: Inverter
                    entities:
                      - entity: sensor.solarman_load_l1_power
                        name: Inv -> Home Power
                      - entity: sensor.solarman_battery_power
                        name: Battery Power
                    hours_to_show: 16
                    points_per_hour: 12
                    line_width: 4
                    font_size: 120
                    animate: true
                    height: 230
                    cache: true
                    show:
                      name: true
                      extrema: true
                      icon: false
                      state: false
                      legend: true
                  - chart_type: bar
                    period: day
                    type: statistics-graph
                    entities:
                      - sensor.solarman_battery_voltage
                    stat_types:
                      - min
                      - max
                      - mean
                    days_to_show: 30
                    min_y_axis: 45
                    max_y_axis: 60
                    fit_y_data: false
                    hide_legend: true
                    title: Battery Voltage
                  - chart_type: bar
                    period: day
                    type: statistics-graph
                    entities:
                      - sensor.solarman_total_battery_charge
                      - sensor.solarman_total_battery_discharge
                    fit_y_data: false
                    hide_legend: false
                    title: Battery Energy
                    stat_types:
                      - change
                    days_to_show: 180
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#inverter-garage'
                button_type: name
                name: Inverter Garage
                icon: mdi:garage-open-variant
                width_desktop: 860px
                margin: 0px
              - type: custom:bubble-card
                card_type: separator
              - type: custom:mushroom-entity-card
                entity: switch.casa_nonna
                name: Casa Nonna
                icon: mdi:electric-switch
                icon_color: deep-orange
              - type: grid
                square: false
                columns: 3
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.stufetta_piccola_switch_0
                    name: Stufetta
                    icon: mdi:gauge-low
                    icon_color: yellow
                  - type: custom:mushroom-entity-card
                    entity: switch.shellyswitch25_c82b96116215_channel_2
                    name: Stufa Bassa
                    icon: mdi:gauge-low
                    icon_color: blue
                  - type: custom:mushroom-entity-card
                    entity: switch.shellyswitch25_c82b96116215_channel_1
                    name: Stufa Alta
                    icon: mdi:gauge-full
                    icon_color: deep-orange
              - type: custom:bar-card
                entities:
                  - entity: sensor.casa_nonna_power
                    name: Inverter
                    max: 1800
                    icon: mdi:lightning-bolt
                  - entity: sensor.stufetta_piccola_switch_0_power
                    name: Stufetta
                    max: 1800
                    icon: mdi:lightning-bolt
                  - entity: sensor.shellyswitch25_c82b96116215_channel_2_power
                    name: Stufa bassa
                    max: 1000
                    icon: mdi:lightning-bolt
                  - entity: sensor.shellyswitch25_c82b96116215_channel_1_power
                    name: Stufa alta
                    max: 1300
                    icon: mdi:lightning-bolt
              - type: history-graph
                entities:
                  - entity: switch.casa_nonna
                    name: Nonna
                  - entity: switch.stufetta_piccola_switch_0
                    name: Stufetta
                  - entity: switch.shellyswitch25_c82b96116215_channel_2
                    name: Low
                  - entity: switch.shellyswitch25_c82b96116215_channel_1
                    name: High
              - type: gauge
                entity: sensor.batterie_garage_voltmeter
                name: Batterie
                unit: V
                min: 20
                max: 28
                needle: true
                severity:
                  green: 0
                  yellow: 23
                  red: 25
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: min
                    name: Min
                    entity: sensor.batterie_garage_voltmeter
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: mean
                    name: Avg
                    entity: sensor.batterie_garage_voltmeter
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: max
                    name: Max
                    entity: sensor.batterie_garage_voltmeter
                columns: 3
              - type: custom:mini-graph-card
                title: Inverter
                entities:
                  - entity: sensor.casa_nonna_power
                    name: Casa Nonna
                hours_to_show: 16
                points_per_hour: 12
                line_width: 4
                font_size: 120
                animate: true
                height: 230
                cache: true
                show:
                  name: true
                  extrema: true
                  icon: false
                  state: false
                  legend: true
              - type: custom:mini-graph-card
                title: Inverter
                entities:
                  - entity: sensor.batterie_garage_voltmeter
                    name: Batteria Grage
                hours_to_show: 16
                points_per_hour: 12
                line_width: 4
                font_size: 120
                animate: true
                height: 230
                cache: true
                show:
                  name: true
                  extrema: true
                  icon: false
                  state: false
                  legend: true
              - type: custom:apexcharts-card
                graph_span: 1d
                header:
                  show: true
                  title: Nonna
                  show_states: true
                  colorize_states: true
                apex_config:
                  legend:
                    show: false
                series:
                  - entity: sensor.nonna_temp_temperature
                    name: Today
                    show:
                      extremas: true
                  - entity: sensor.nonna_temp_temperature
                    offset: '-1d'
                    name: Yesterday
                  - entity: sensor.nonna_temp_temperature
                    offset: '-2d'
                    name: 2 Days ago
                    color: yellow
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.dc_garage
                    name: Dc Garage
                    icon_color: lime
                  - type: custom:mushroom-entity-card
                    entity: sensor.dc_garage_power
                    name: Dc power
                    primary_info: state
                    secondary_info: name
                columns: 2
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.casa_nonna_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.casa_nonna_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.casa_nonna_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.casa_nonna_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 14 ? "darkred" : 
                                 value > 12 ? "red" : 
                                 value > 10? "darkorange" : 
                                 value > 5 ? "orange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.casa_nonna_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
              - type: entities
                entities:
                  - entity: input_number.garage_battery_tensione_cut_off
                    name: Tensione OFF
                  - entity: input_number.garage_battery_voltage_on
                    name: Tensione ON
                  - entity: automation.casa_nonna_tensione_off
                    name: Spegni a Tensione OFF
                    secondary_info: last-triggered
                  - entity: automation.garage_on_tensione
                    name: ON a Tensione ON
                    secondary_info: last-triggered
                  - entity: automation.stufa_alta_off_a_tensione_off
                    name: Stufa Alta OFF
                    secondary_info: last-triggered
                  - entity: automation.stufa_bassa_off_a_tensione_off
                    name: Stufa Bassa OFF
                    secondary_info: last-triggered
                  - entity: input_number.casa_nonna_power_on
                    name: Soglia Solar
                  - entity: automation.casa_nonna_solar_off
                    name: OFF Solar < soglia
                    secondary_info: last-triggered
                  - entity: automation.casa_nonna_on_solar
                    name: ON Solar > soglia
                    secondary_info: last-triggered
                  - entity: input_number.nonna_temp_limit
                    name: Limite temperatura
                  - entity: automation.nonna_off_se_temp_limite
                    name: OFF se sopra Temp Limite
                    secondary_info: last-triggered
                  - entity: sensor.shellyswitch25_c82b96116215_device_temperature
                  - entity: sensor.stufetta_piccola_switch_0_device_temperature
                  - entity: sensor.casa_nonna_device_temperature
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#inverter-charts'
                name: Inverter Charts
                icon: mdi:chart-histogram
                card_layout: large
                button_type: state
                entity: sensor.solarman_battery_soc
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: false
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:mini-graph-card
                title: Inverter
                entities:
                  - entity: sensor.solarman_pv1_power
                    name: Nord
                color_thresholds:
                  - value: 300
                    color: '#395ce6'
                  - color: '#cce639'
                  - value: 1600
                    color: '#ff0000'
                hours_to_show: 16
                points_per_hour: 12
                line_width: 4
                font_size: 120
                animate: true
                height: 230
                cache: true
                show:
                  name: true
                  extrema: true
                  icon: false
                  state: false
                  legend: true
              - type: custom:mini-graph-card
                title: Inverter
                entities:
                  - entity: sensor.solarman_battery_voltage
                    name: Battery Voltage
                color_thresholds:
                  - value: 300
                    color: '#395ce6'
                  - color: '#cce639'
                  - value: 1600
                    color: '#ff0000'
                hours_to_show: 16
                points_per_hour: 12
                line_width: 4
                font_size: 120
                animate: true
                height: 230
                cache: true
                show:
                  name: true
                  extrema: true
                  icon: false
                  state: false
                  legend: true
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.solarman_daily_battery_charge
                    fill: tozeroy
                  - entity: sensor.solarman_daily_battery_discharge
                    fill: tozeroy
                  - entity: sensor.solarman_battery_soc
                title: Battery
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  type: bar
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - type: custom:mini-graph-card
                title: Inverter
                entities:
                  - entity: sensor.solarman_load_l1_power
                    name: Inv -> Home Power
                  - entity: sensor.solarman_battery_power
                    name: Battery Power
                hours_to_show: 16
                points_per_hour: 12
                line_width: 4
                font_size: 120
                animate: true
                height: 230
                cache: true
                show:
                  name: true
                  extrema: true
                  icon: false
                  state: false
                  legend: true
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.solarman_battery_voltage
                stat_types:
                  - min
                  - max
                  - mean
                days_to_show: 30
                min_y_axis: 45
                max_y_axis: 60
                fit_y_data: false
                hide_legend: true
                title: Battery Voltage
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Battery charge
                refresh_interval: auto
                entities:
                  - entity: sensor.solarman_daily_battery_charge
                    name: Charge
                    unit_of_measurement: kWh
                    texttemplate: '%{y}'
                    type: bar
                    statistic: state
                    period: day
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = parseFloat(y.toFixed(2));
                          return value > 5 ? "darkred" : 
                                 value > 4 ? "red" : 
                                 value > 3 ? "darkorange" : 
                                 value > 2 ? "orange" : 
                                 value > 1 ? "purple" : 
                                 value > 0 ? "blue" : "green";
                        })
                    filters:
                      - filter: i >0
                layout:
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 12
                          step: hour
                        - count: 1
                          step: day
                        - count: 7
                          step: day
                        - count: 1
                          step: month
                        - count: 3
                          step: month
                        - count: 1
                          step: year
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Battery discharge
                refresh_interval: auto
                entities:
                  - entity: sensor.solarman_daily_battery_discharge
                    name: Charge
                    unit_of_measurement: kWh
                    texttemplate: '%{y}'
                    type: bar
                    statistic: state
                    period: day
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = parseFloat(y.toFixed(2));
                          return value > 5 ? "darkred" : 
                                 value > 4 ? "red" : 
                                 value > 3 ? "darkorange" : 
                                 value > 2 ? "orange" : 
                                 value > 1 ? "purple" : 
                                 value > 0 ? "blue" : "green";
                        })
                    filters:
                      - filter: i >0
                layout:
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 12
                          step: hour
                        - count: 1
                          step: day
                        - count: 7
                          step: day
                        - count: 1
                          step: month
                        - count: 3
                          step: month
                        - count: 1
                          step: year
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#network'
                name: Network
                icon: mdi:network-outline
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: vertical-stack
                cards:
                  - square: false
                    type: grid
                    cards:
                      - type: custom:mushroom-entity-card
                        entity: binary_sensor.upnp_igd_wan_status
                        name: Internet
                        primary_info: state
                        secondary_info: name
                        fill_container: true
                        icon_color: yellow
                      - type: custom:mushroom-entity-card
                        entity: sensor.upnp_igd_external_ip
                        name: Ip
                        primary_info: state
                        secondary_info: name
                        icon_color: green
                    columns: 2
                  - type: custom:uptime-card
                    title_template: Internet
                    entity: binary_sensor.upnp_igd_wan_status
                    ok: 'on'
                    ko: 'off'
                    name: Internet
                    hours_to_show: 168
                    none: Unknown
                    icon: mdi:web
                    ko_icon: mdi:signal-off
                    title_adaptive_color: true
                    icon_adaptive_color: true
                    status_adaptive_color: true
                    bar:
                      height: 15
                      round: 90
                      spacing: 2
                      amount: 30
                    init: {}
                    color: {}
                    severity: 100
                    update_interval: 60
                  - type: entity
                    entity: sensor.network_scanner
                    name: WiFi Selva
                    icon: mdi:access-point-network
                    state_color: true
                  - show_name: true
                    show_icon: true
                    show_state: true
                    type: glance
                    entities:
                      - entity: device_tracker.floor00_deco
                        name: Floor 00
                        icon: mdi:router-wireless-settings
                      - entity: device_tracker.floor01_deco
                        name: Floor 01
                        icon: mdi:router-wireless-settings
                      - entity: device_tracker.floor02_deco
                        name: Floor 02
                        icon: mdi:router-wireless-settings
                      - entity: device_tracker.nonna_deco
                        name: Nonna
                        icon: mdi:router-wireless-settings
                      - entity: device_tracker.garage_deco
                        name: Garage
                        icon: mdi:router-wireless
                      - entity: device_tracker.switchnorth_deco
                        name: North
                        icon: mdi:router-wireless
                    state_color: true
              - type: custom:vertical-stack-in-card
                title: Speed Test
                cards:
                  - type: grid
                    square: false
                    columns: 3
                    cards:
                      - type: custom:mushroom-entity-card
                        entity: sensor.speedtest_download
                        primary_info: state
                        secondary_info: name
                        name: Download
                        icon_color: green
                        layout: vertical
                      - type: custom:mushroom-entity-card
                        entity: sensor.speedtest_upload
                        primary_info: state
                        secondary_info: name
                        name: Upload
                        icon_color: blue
                        layout: vertical
                      - type: custom:mushroom-entity-card
                        entity: sensor.speedtest_ping
                        primary_info: state
                        secondary_info: name
                        name: Ping
                        icon_color: yellow
                        layout: vertical
                  - type: custom:mini-graph-card
                    entities:
                      - entity: sensor.speedtest_download
                        name: Download
                        color: var(--green-color)
                      - entity: sensor.speedtest_upload
                        name: Upload
                        color: var(--blue-color)
                      - entity: sensor.speedtest_ping
                        name: Ping
                        color: var(--yellow-color)
                        y_axis: secondary
                    hours_to_show: 72
                    points_per_hour: 6
                    line_width: 3
                    font_size: 100
                    animate: true
                    show:
                      name: false
                      icon: false
                      extrema: true
                      state: false
                      legend: false
                      fill: fade
          - type: vertical-stack
            cards:
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    entity: input_boolean.sunny_day
                    name: sunny
                    icon_color: deep-orange
                    primary_info: name
                    secondary_info: none
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    entity: input_boolean.manualboiler
                    icon_color: blue
                    name: Manual boiler
                    primary_info: name
                    secondary_info: none
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    icon_color: green
                    primary_info: name
                    name: 1 Stage
                    entity: binary_sensor.combo_minus05_enel_plus1_solar
                    secondary_info: none
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    icon_color: deep-orange
                    primary_info: name
                    name: 2 Stage
                    entity: binary_sensor.combo_second_stage
                    icon: mdi:solar-power
                    secondary_info: none
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    icon_color: deep-orange
                    primary_info: name
                    name: 3 Stage
                    icon: mdi:solar-power-variant-outline
                    secondary_info: none
                    layout: vertical
                    entity: binary_sensor.combo_third_stage
                columns: 4
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#scheduler'
                name: Scheduler
                icon: mdi:calendar-arrow-right
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: vertical-stack
                cards:
                  - type: custom:scheduler-card
                    include:
                      - automation
                      - binary_sensor
                      - button
                      - climate
                      - device_tracker
                      - input_boolean
                      - input_number
                      - light
                      - media_player
                      - notify
                      - number
                      - person
                      - select
                      - sensor
                      - sun
                      - switch
                    exclude: []
                    sort_by:
                      - state
                      - relative-time
                    display_options:
                      primary_info: '{entity}: {action}'
                      secondary_info:
                        - relative-time
                      icon: action
                    title: Scheduler
                    tags: []
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#automations'
                name: 'Automations '
                icon: mdi:robot
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: vertical-stack
                title: Automations
                cards:
                  - show_name: true
                    show_icon: true
                    type: button
                    tap_action:
                      action: navigate
                      navigation_path: /config/automation/dashboard
                    name: Automations
                    icon: mdi:home-automation
                    show_state: true
                    icon_height: 35px
                  - type: custom:auto-entities
                    card:
                      type: entities
                      state_color: true
                    filter:
                      include:
                        - entity_id: automation*
                    sort:
                      method: last_triggered
                      reverse: true
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#cctv'
                name: Camera
                icon: mdi:cctv
                card_layout: large
                button_type: state
                entity: binary_sensor.frigate_full_access_running
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:mushroom-template-card
                primary: Frigate
                secondary: ''
                icon: mdi:cctv
                icon_color: yellow
                tap_action:
                  action: navigate
                  navigation_path: /ccab4aaf_frigate-fa
                fill_container: true
                multiline_secondary: true
              - square: false
                type: grid
                cards:
                  - show_state: false
                    show_name: false
                    camera_view: live
                    type: picture-entity
                    image: https://demo.home-assistant.io/stub_config/bedroom.png
                    camera_image: camera.192_168_0_105
                    entity: camera.192_168_0_105
                  - show_state: false
                    show_name: false
                    camera_view: live
                    type: picture-entity
                    image: https://demo.home-assistant.io/stub_config/bedroom.png
                    camera_image: camera.192_168_0_105
                    entity: camera.192_168_0_101
                  - show_state: false
                    show_name: false
                    camera_view: live
                    type: picture-entity
                    image: https://demo.home-assistant.io/stub_config/bedroom.png
                    camera_image: camera.192_168_0_105
                    entity: camera.192_168_0_102
                  - show_state: false
                    show_name: false
                    camera_view: live
                    type: picture-entity
                    image: https://demo.home-assistant.io/stub_config/bedroom.png
                    camera_image: camera.192_168_0_105
                    entity: camera.192_168_0_103
                columns: 1
              - square: false
                type: grid
                cards:
                  - type: vertical-stack
                    cards:
                      - show_state: true
                        show_name: true
                        camera_view: auto
                        type: picture-entity
                        entity: image.entrance_person
                  - type: vertical-stack
                    cards:
                      - show_state: true
                        show_name: true
                        camera_view: auto
                        type: picture-entity
                        entity: image.back_person
                  - type: vertical-stack
                    cards:
                      - show_state: true
                        show_name: true
                        camera_view: auto
                        type: picture-entity
                        entity: image.garage_person
                  - type: vertical-stack
                    cards:
                      - show_state: true
                        show_name: true
                        camera_view: auto
                        type: picture-entity
                        entity: image.garden_person
                columns: 2
              - type: vertical-stack
                cards:
                  - square: false
                    type: grid
                    cards:
                      - type: custom:mushroom-entity-card
                        entity: input_boolean.person_notification
                        icon_color: primary
                        fill_container: true
                        name: Notification
                        double_tap_action:
                          action: toggle
                        view_layout:
                          position: sidebar
                      - type: custom:mushroom-entity-card
                        entity: switch.back_detect
                        double_tap_action:
                          action: toggle
                      - type: custom:mushroom-entity-card
                        entity: switch.garden_detect
                        double_tap_action:
                          action: toggle
                      - type: custom:mushroom-entity-card
                        entity: switch.entrance_detect
                        double_tap_action:
                          action: toggle
                      - type: custom:mushroom-entity-card
                        entity: switch.garage_detect
                        double_tap_action:
                          action: toggle
                    columns: 2
                  - type: custom:uptime-card
                    entity: binary_sensor.frigate_full_access_running
                    icon: mdi:cctv
                    bar:
                      height: 110
                      round: 0
                      spacing: 3
                      amount: 42
                    hours_to_show: 168
                    update_interval: 1
                    init: {}
                    color: {}
                    alias:
                      ok: Online
                      ko: Offline
                    show:
                      header: true
                    tap_action: {}
                    tooltip: {}
                    blink: {}
                    clip: {}
                    view_layout:
                      position: sidebar
                view_layout:
                  position: sidebar
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#energy'
                name: 'Energy '
                icon: mdi:home-lightning-bolt
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: vertical-stack
                cards:
                  - type: custom:plotly-graph
                    hours_to_show: 31d
                    title: Total Solar
                    refresh_interval: auto
                    entities:
                      - entity: sensor.solar_energy
                        name: Sud
                        unit_of_measurement: kWh
                        type: bar
                        statistic: state
                        period: day
                        filters:
                          - resample: 1d
                          - delta
                          - map_y: parseFloat(y.toFixed(2))
                        marker:
                          color: blue
                      - entity: sensor.solarman_total_production
                        name: Nord
                        unit_of_measurement: kWh
                        type: bar
                        statistic: state
                        period: day
                        filters:
                          - resample: 1d
                          - delta
                          - map_y: parseFloat(y.toFixed(2))
                        marker:
                          color: red
                      - entity: sensor.casa_nonna_energy
                        name: Garage
                        unit_of_measurement: kWh
                        type: bar
                        statistic: state
                        period: day
                        filters:
                          - resample: 1d
                          - delta
                          - map_y: parseFloat(y.toFixed(2))
                        marker:
                          color: green
                    layout:
                      height: 500
                      barmode: stack
                      xaxis:
                        rangeselector:
                          'y': 1.2
                          buttons:
                            - count: 7
                              step: day
                            - count: 30
                              step: day
                            - count: 90
                              step: day
                            - count: 6
                              step: month
                            - count: 1
                              step: year
                  - type: custom:plotly-graph
                    hours_to_show: 31d
                    title: Total Solar
                    refresh_interval: auto
                    entities:
                      - entity: sensor.home_energy
                        name: Home
                        unit_of_measurement: kWh
                        type: bar
                        statistic: state
                        period: day
                        filters:
                          - resample: 1d
                          - delta
                          - map_y: parseFloat(y.toFixed(2))
                        marker:
                          color: blue
                      - entity: sensor.solarman_total_load_consumption
                        name: Inverter Nord
                        unit_of_measurement: kWh
                        type: bar
                        statistic: state
                        period: day
                        filters:
                          - resample: 1d
                          - delta
                          - map_y: parseFloat(y.toFixed(2))
                        marker:
                          color: red
                    layout:
                      height: 500
                      barmode: stack
                      xaxis:
                        rangeselector:
                          'y': 1.2
                          buttons:
                            - count: 7
                              step: day
                            - count: 30
                              step: day
                            - count: 90
                              step: day
                            - count: 6
                              step: month
                            - count: 1
                              step: year
                  - type: vertical-stack
                    title: Giornaliero
                    cards:
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.consume_month
                        days_to_show: 30
                        title: Total Energy
                        hide_legend: true
                        stat_types:
                          - change
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - entity: sensor.enel_energy
                            name: Buy
                          - entity: sensor.enel_energy_returned
                            name: Sell
                        stat_types:
                          - change
                        days_to_show: 30
                        title: Enel
                        hide_legend: false
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - entity: sensor.solar_energy
                            name: Solar
                          - sensor.solarman_daily_production
                        stat_types:
                          - change
                        days_to_show: 30
                        title: Solar
                        hide_legend: true
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.boiler_resistance_duration
                          - sensor.boiler_heat_pump_duration
                          - sensor.boiler_pump_resistance_duration
                        hide_legend: false
                        days_to_show: 30
                        stat_types:
                          - max
                        title: Duration Boiler
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.boiler_energy
                        hide_legend: true
                        days_to_show: 30
                        title: BoilerEnergy
                        stat_types:
                          - change
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.ac_scala_on_duration
                          - sensor.ac_sala_on_duration
                        hide_legend: false
                        days_to_show: 30
                        title: AC time
                        stat_types:
                          - max
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.ac_total_energy
                        hide_legend: false
                        days_to_show: 30
                        title: AC energy
                        stat_types:
                          - change
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.battery_net_energy_integral
                          - sensor.solarman_daily_battery_charge
                        hide_legend: true
                        days_to_show: 30
                        title: Battery energy
                        stat_types:
                          - change
                      - chart_type: bar
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.05kwsolar_on_duration
                          - sensor.1kwsolar_on_duration
                          - sensor.3kwsolar_on_duration
                        hide_legend: false
                        days_to_show: 30
                        stat_types:
                          - max
                        title: Duration 1kW
                      - chart_type: line
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.shelly_h_t_floor01_temperature_2
                          - sensor.home_temperature
                        hide_legend: true
                        days_to_show: 30
                        stat_types:
                          - max
                          - min
                          - mean
                        title: Home Temperature
                      - chart_type: line
                        period: day
                        type: statistics-graph
                        entities:
                          - sensor.washmachine_energy
                          - sensor.frigo_energy
                          - sensor.forno_energy
                          - sensor.washdisher_energy
                          - sensor.lavastoviglie_energy
                        hide_legend: false
                        days_to_show: 30
                        stat_types:
                          - change
                        title: Loads energy
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#shelly'
                name: Shelly
                icon: mdi:switch
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: vertical-stack
                title: Tables
                cards:
                  - type: custom:auto-entities
                    filter:
                      include:
                        - entity_id: /sensor.*_rssi(_[0-9]+)?/
                    sort:
                      method: state
                      numeric: true
                      reverse: true
                    card:
                      type: custom:bar-card
                      style: |-
                        bar-card-value {
                          font-size: 15px;
                          font-weight: bold;
                          text-shadow: 1px 1px #0005;
                        }
                      min: -100
                      max: -10
                      positions:
                        indicator: outside
                        icon: false
                        name: inside
                      animation:
                        state: 'true'
                        speed: 3
                      severity:
                        - color: Red
                          from: -65
                        - color: Orange
                          from: -65
                          to: -50
                        - color: Blue
                          from: -50
                          to: -40
                        - color: Green
                          from: -40
                          to: -10
                        - hide: null
                          from: -5
                          to: 5
                  - type: custom:auto-entities
                    filter:
                      include:
                        - options: {}
                          entity_id: /sensor.*_cloud/
                          area: shelly
                    card:
                      type: history-graph
                      hours_to_show: 168
                    sort:
                      method: last_changed
                      reverse: true
                  - type: custom:auto-entities
                    filter:
                      include:
                        - options: {}
                          entity_id: /sensor.*device_temperature(_[0-9]+)?/
                      exclude:
                        - options: {}
                          entity_id: /sensor.SelvaHome*/
                    sort:
                      method: state
                      reverse: true
                      numeric: true
                    show_empty: true
                    card:
                      type: custom:bar-card
                      style: |-
                        bar-card-value {
                          font-size: 15px;
                          font-weight: bold;
                          text-shadow: 1px 1px #0005;
                        }
                      positions:
                        indicator: outside
                        icon: false
                        name: inside
                      max: 60
                      animation:
                        state: 'true'
                        speed: 3
                      severity:
                        - color: Red
                          from: 50
                        - color: Orange
                          from: 40
                          to: 50
                        - color: Blue
                          from: 30
                          to: 40
                        - color: Green
                          from: 10
                          to: 30
                        - hide: null
                          from: -5
                          to: 5
                  - type: custom:auto-entities
                    filter:
                      include:
                        - entity_id: /sensor.*_uptime/
                          area: shelly
                    sort:
                      method: state
                      numeric: false
                      reverse: true
                    card:
                      type: entities
                  - type: custom:auto-entities
                    filter:
                      include:
                        - options: {}
                          entity_id: /sensor.*_uptime/
                          area: shelly
                    card:
                      type: history-graph
                      hours_to_show: 168
                    sort:
                      method: state
                      reverse: true
                      numeric: true
                  - type: custom:auto-entities
                    filter:
                      include:
                        - options: {}
                          entity_id: /sensor.*_energy/
                          area: shelly
                    sort:
                      method: state
                      numeric: true
                      reverse: true
                    card:
                      type: entities
                      state_color: true
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#home-temp'
                name: 'Temperature '
                icon: mdi:thermometer
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: vertical-stack
                cards:
                  - type: custom:apexcharts-card
                    graph_span: 1d
                    header:
                      show: true
                      title: Casa
                      show_states: true
                      colorize_states: true
                    apex_config:
                      legend:
                        show: false
                    series:
                      - entity: sensor.home_temperature
                        name: Sala
                        group_by:
                          func: avg
                          duration: 1h
                        show:
                          extremas: true
                      - entity: sensor.bagno_temp_temperature
                        name: Bagno
                        group_by:
                          func: avg
                          duration: 1h
                      - entity: sensor.cucina_temp_temperature
                        name: Cucina
                        color: yellow
                        group_by:
                          func: avg
                          duration: 1h
                  - type: custom:apexcharts-card
                    graph_span: 1d
                    header:
                      show: true
                      title: Sala
                      show_states: true
                      colorize_states: true
                    apex_config:
                      legend:
                        show: false
                    series:
                      - entity: sensor.home_temperature
                        name: Today
                        show:
                          extremas: true
                      - entity: sensor.home_temperature
                        offset: '-1d'
                        name: Yesterday
                      - entity: sensor.home_temperature
                        offset: '-2d'
                        name: 2 Days ago
                        color: yellow
                  - type: custom:apexcharts-card
                    graph_span: 1d
                    header:
                      show: true
                      title: Bagno
                      show_states: true
                      colorize_states: true
                    apex_config:
                      legend:
                        show: false
                    series:
                      - entity: sensor.bagno_temp_temperature
                        name: Today
                        group_by:
                          func: avg
                          duration: 1h
                        show:
                          extremas: true
                      - entity: sensor.bagno_temp_temperature
                        offset: '-1d'
                        name: Yesterday
                        group_by:
                          func: avg
                          duration: 1h
                      - entity: sensor.bagno_temp_temperature
                        offset: '-2d'
                        name: '-2d'
                        color: yellow
                        group_by:
                          func: avg
                          duration: 1h
                  - type: custom:apexcharts-card
                    graph_span: 1d
                    header:
                      show: true
                      title: Cucina
                      show_states: true
                      colorize_states: true
                    apex_config:
                      legend:
                        show: false
                    series:
                      - entity: sensor.cucina_temp_temperature
                        name: Today
                        group_by:
                          func: avg
                          duration: 1h
                        show:
                          extremas: true
                      - entity: sensor.cucina_temp_temperature
                        offset: '-1d'
                        name: Yesterday
                        group_by:
                          func: avg
                          duration: 1h
                      - entity: sensor.cucina_temp_temperature
                        offset: '-2d'
                        name: '-2d'
                        color: yellow
                        group_by:
                          func: avg
                          duration: 1h
                  - type: custom:apexcharts-card
                    graph_span: 1d
                    header:
                      show: true
                      title: Out
                      show_states: true
                      colorize_states: true
                    apex_config:
                      legend:
                        show: false
                    series:
                      - entity: input_number.temp_out_saved
                        name: Today
                        group_by:
                          func: avg
                          duration: 1h
                        show:
                          extremas: true
                      - entity: input_number.temp_out_saved
                        offset: '-1d'
                        name: Yesterday
                        group_by:
                          func: avg
                          duration: 1h
                      - entity: input_number.temp_out_saved
                        offset: '-2d'
                        name: '-2d'
                        color: yellow
                        group_by:
                          func: avg
                          duration: 1h
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#solarman-detail'
                name: 'Inverter Nord '
                icon: mdi:list-status
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: custom:auto-entities
                card:
                  type: entities
                filter:
                  include:
                    - {}
                  exclude: []
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#weather'
                name: Weather
                icon: mdi:weather-cloudy-clock
                card_layout: large
                button_type: state
                entity: sensor.temperatureout
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: false
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: vertical-stack
                cards:
                  - type: vertical-stack
                    title: Previsioni
                    cards:
                      - type: iframe
                        url: >-
                          https://meteo.search.ch/widget/Camedo.it.html?bgcolor=dedede&amp;fgcolor=000000&amp;days=1
                        aspect_ratio: '1'
                      - type: custom:sun-card
                      - type: picture
                        image: https://meteo.search.ch/images/meteosat.png
                        tap_action:
                          action: url
                          url_path: >-
                            https://www.meteoswiss.admin.ch/local-forecasts/camedo/6659.html#forecast-tab=detail-view
                        hold_action:
                          action: none
                      - type: custom:mushroom-entity-card
                        entity: sensor.moon_phase
                        layout: vertical
                        primary_info: state
                        secondary_info: none
                  - type: custom:plotly-graph
                    entities:
                      - entity: sensor.temperatureout
                    title: Out
                    logarithmic_scale: false
                    hours_to_show: 168
                    refresh_interval: 10
                    autorange_after_scroll: true
                    layout:
                      height: 600
                      xaxis:
                        rangeselector:
                          'y': 1.2
                          buttons:
                            - count: 16
                              step: hour
                            - count: 48
                              step: hour
                            - count: 7
                              step: day
                            - count: 30
                              step: day
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#pi'
                name: Pi
                icon: mdi:server-minus-outline
                card_layout: large
                entity: weather.selvahome
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
                button_type: name
              - type: vertical-stack
                cards:
                  - square: true
                    type: grid
                    cards:
                      - type: gauge
                        entity: sensor.load_1m
                        unit: '%'
                        max: 5
                        min: 1
                        needle: true
                        severity:
                          green: 0
                          yellow: 2
                          red: 3.5
                      - type: gauge
                        entity: sensor.load_5m
                        unit: '%'
                        max: 5
                        min: 1
                        needle: true
                        severity:
                          green: 0
                          yellow: 2
                          red: 3.5
                      - type: gauge
                        entity: sensor.load_15m
                        unit: '%'
                        max: 5
                        min: 1
                        needle: true
                        severity:
                          green: 0
                          yellow: 2
                          red: 3.5
                    columns: 3
                  - type: custom:bar-card
                    entities:
                      - entity: sensor.monitor_power
                        name: Pi5 power
                      - entity: sensor.disk_use
                        name: Disk
                        min: '0'
                        max: '756'
                      - entity: sensor.processor_use
                        name: CPU
                      - entity: sensor.memory_use
                        name: RAM
                        min: '0'
                        max: '6000'
                      - entity: sensor.memory_use_percent
                        name: RAM %
                      - entity: sensor.disk_use_percent_config
                        name: Disk %
                      - entity: sensor.rack_temperature_2
                        name: Rack temp
                      - entity: sensor.rackpower_power
                        name: Rack power
                  - square: false
                    type: grid
                    cards:
                      - type: custom:uptime-card
                        title_template: HAos
                        entity: device_tracker.pi_raspeberry5
                        ok: home
                        ko: unavailable
                        hours_to_show: 168
                        none: Unknown
                        icon: mdi:signal-cellular-outline
                        ko_icon: mdi:signal-off
                        title_adaptive_color: true
                        icon_adaptive_color: true
                        status_adaptive_color: true
                        bar:
                          height: 18
                          round: 30
                          spacing: 2
                          amount: 25
                        init: {}
                        color: {}
                        severity: 100
                        update_interval: 60
                    columns: 1
              - type: custom:apexcharts-card
                experimental:
                  color_threshold: true
                header:
                  show: true
                  title: Workstation
                  show_states: true
                  colorize_states: true
                graph_span: 24h
                apex_config:
                  legend:
                    show: false
                series:
                  - entity: sensor.processor_use
                    show:
                      extremas: true
                    name: CPU
                    type: line
                    group_by:
                      func: avg
                      duration: 15min
                  - entity: sensor.memory_use_percent
                    show:
                      extremas: true
                    name: RAM
                    type: area
                    group_by:
                      func: avg
                      duration: 15min
    max_columns: 4
    title: New
    icon: mdi:new-box
  - type: sidebar
    path: ''
    cards:
      - type: custom:sunsynk-power-flow-card
        cardstyle: full
        show_solar: true
        battery:
          show_daily: true
          auto_scale: true
          show_absolute: false
          dynamic_colour: true
          animate: false
          show_remaining_energy: true
          hide_soc: true
          count: 1
          invert_power: false
          remaining_energy_to_shutdown: false
          soc_end_of_charge: 100
          max_power: 2000
          shutdown_soc: 40
          shutdown_soc_offgrid: 40
          energy: 4500
        solar:
          show_daily: true
          mppts: 1
          dynamic_colour: true
          pv1_max_power: 3000
          max_power: 3000
          invert_flow: false
          colour: '#fefb41'
          pv1_name: Nord
          auto_scale: true
        load:
          show_daily: true
          load1_icon: ''
          auto_scale: true
          invert_load: false
          dynamic_colour: true
          dynamic_icon: true
          colour: '#36b065'
          off_colour: '#737373'
          max_power: 2000
          label_daily_load: Batt + Solar
          show_aux: false
          aux_name: Ac
        grid:
          show_daily_buy: false
          show_daily_sell: true
          show_nonessential: false
          grid_name: Casa
          label_daily_grid_buy: Comprata casa
          label_daily_grid_sell: Solar Venduta
          additional_loads: 1
          nonessential_icon: mdi:air-conditioner
          invert_grid: true
          nonessential_name: Ac
          off_threshold: 10
          grid_off_colour: '#adadad'
          disconnected_icon: mdi:home
          import_icon: mdi:home
          export_icon: mdi:home
          invert_flow: true
        entities:
          use_timer_248: switch.solarman_toggle_system_timer
          inverter_voltage_154: sensor.solarman_grid_voltage_l1
          load_frequency_192: sensor.solarman_load_frequency
          inverter_current_164: sensor.solarman_current_l1
          inverter_power_175: sensor.solarman_micro_inverter_power
          grid_connected_status_194: binary_sensor.solarman_grid_status
          inverter_status_59: sensor.solarman_status_connection
          day_battery_charge_70: sensor.solarman_daily_battery_charge
          day_battery_discharge_71: sensor.solarman_daily_battery_discharge
          battery_voltage_183: sensor.solarman_battery_voltage
          battery_soc_184: sensor.solarman_battery_soc
          battery_power_190: sensor.solarman_battery_power
          battery_current_191: sensor.solarman_battery_current
          grid_power_169: sensor.solarman_total_grid_power
          day_grid_import_76: sensor.solarman_daily_energy_bought
          day_grid_export_77: sensor.solarman_daily_total_consumption
          day_load_energy_84: sensor.solarman_daily_total_energy
          essential_power: sensor.battery_out_power
          aux_power_166: sensor.solarman_total_load_power
          day_pv_energy_108: sensor.solarman_daily_production
          pv1_power_186: sensor.solarman_pv1_power
          pv2_power_187: sensor.solarman_pv2_power
          pv1_voltage_109: sensor.solarman_pv1_voltage
          pv1_current_110: sensor.solarman_pv1_current
          pv2_voltage_111: sensor.solarman_pv2_voltage
          pv2_current_112: sensor.solarman_pv2_current
          battery_temp_182: sensor.solarman_battery_temperature
          battery_rated_capacity: '200'
          battery_status: sensor.solarman_battery_status
          total_pv_generation: sensor.solarman_total_production
          grid_ct_power_total: sensor.solarman_total_grid_power
          dc_transformer_temp_90: sensor.solarman_dc_temperature
          grid_ct_power_172: sensor.solarman_internal_ct_l1_power
          grid_voltage: sensor.enel_voltage
          load_power_L1: sensor.solarman_load_l1_power
          aux_connected_status: sensor.solarman_grid_connected_status
        inverter:
          model: deye
          modern: true
          auto_scale: true
          autarky: energy
          three_phase: false
        large_font: true
        wide: false
        show_battery: true
        show_grid: true
        decimal_places: 1
        decimal_places_energy: 1
        dynamic_line_width: true
        card_height: '600'
        battery2:
          hide_soc: false
          soc_end_of_charge: sensor.battery_self_used_percent
          remaining_energy_to_shutdown: false
          show_remaining_energy: true
        title_size: '3'
      - square: false
        type: grid
        cards:
          - type: entities
            entities:
              - entity: input_number.kwh_to_turn_on_switch
                name: Soglia produzione ON
              - entity: input_number.battery_cut_off
                name: Tensione OFF
              - entity: input_number.autoconsumo_cut_off
                name: Autoconsumo OFF
              - entity: sensor.battery_self_used_percent
                name: Consumato
            title: Battery Setting
            state_color: true
          - type: entities
            entities:
              - entity: automation.accendi_se_caricato_x
                secondary_info: last-triggered
                name: Produzione Soglia ON
                icon: mdi:solar-power-variant
              - entity: automation.battery_off_at_soc_level
                name: Battery OFF  a Tensione OFF
                secondary_info: last-triggered
                icon: mdi:battery-10
              - entity: automation.battery_autoconsumo
                secondary_info: last-triggered
                name: Autonconsumo OFF
                icon: mdi:home-battery-outline
              - entity: sensor.solarman_status_lastupdate
                name: Update
          - type: history-graph
            entities:
              - entity: switch.sw1
                name: Sala
              - entity: switch.sw2
                name: Scala
              - entity: switch.ininverter
                name: GRID
            hours_to_show: 12
          - type: gauge
            entity: sensor.solarman_battery_voltage
            name: Battery V
            needle: true
            severity:
              green: 46
              yellow: 48
              red: 51
            min: 46
            max: 57
            unit: V
            view_layout:
              position: sidebar
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: min
                entity: sensor.solarman_battery_voltage
                name: Min
                unit: V
                icon: mdi:battery-40
                view_layout:
                  position: sidebar
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: mean
                entity: sensor.solarman_battery_voltage
                name: Avg
                unit: V
                view_layout:
                  position: sidebar
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: max
                entity: sensor.solarman_battery_voltage
                name: Max
                unit: V
                view_layout:
                  position: sidebar
            columns: 3
            view_layout:
              position: sidebar
        columns: 1
        view_layout:
          position: sidebar
      - type: custom:plotly-graph
        entities:
          - entity: sensor.solar_power
            name: Sud
          - entity: sensor.solarman_pv1_power
            name: Nord
        title: Solar
        logarithmic_scale: false
        hours_to_show: 16
        refresh_interval: 10
        autorange_after_scroll: true
        layout:
          height: 500
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 3
                  step: hour
                - count: 16
                  step: hour
                - count: 36
                  step: hour
                - count: 5
                  step: day
      - type: custom:plotly-graph
        entities:
          - entity: sensor.solarman_battery_voltage
        title: Battery
        logarithmic_scale: false
        hours_to_show: 16
        refresh_interval: 10
        autorange_after_scroll: true
        layout:
          height: 500
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 3
                  step: hour
                - count: 16
                  step: hour
                - count: 36
                  step: hour
                - count: 5
                  step: day
      - type: custom:plotly-graph
        entities:
          - entity: sensor.solarman_inverter_l1_power
          - entity: sensor.solarman_battery_power
        title: Power
        logarithmic_scale: false
        hours_to_show: 16
        refresh_interval: 10
        autorange_after_scroll: true
        layout:
          height: 700
          type: bar
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 3
                  step: hour
                - count: 16
                  step: hour
                - count: 36
                  step: hour
                - count: 5
                  step: day
      - type: custom:plotly-graph
        entities:
          - entity: sensor.solarman_daily_battery_charge
            fill: tozeroy
          - entity: sensor.solarman_daily_battery_discharge
            fill: tozeroy
          - entity: sensor.solarman_battery_soc
        title: Battery
        logarithmic_scale: false
        hours_to_show: 16
        refresh_interval: 10
        autorange_after_scroll: true
        layout:
          height: 500
          type: bar
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 3
                  step: hour
                - count: 16
                  step: hour
                - count: 36
                  step: hour
                - count: 5
                  step: day
      - chart_type: bar
        period: day
        type: statistics-graph
        entities:
          - sensor.solarman_battery_voltage
        stat_types:
          - min
          - max
          - mean
        days_to_show: 30
        min_y_axis: 45
        max_y_axis: 60
        fit_y_data: false
        hide_legend: true
        title: Battery Voltage
      - type: custom:plotly-graph
        hours_to_show: 31d
        title: Battery charge
        refresh_interval: auto
        entities:
          - entity: sensor.solarman_daily_battery_charge
            name: Charge
            unit_of_measurement: kWh
            texttemplate: '%{y}'
            type: bar
            statistic: state
            period: day
            marker:
              color: |-
                $ex ys.map(y => {
                  let value = parseFloat(y.toFixed(2));
                  return value > 5 ? "darkred" : 
                         value > 4 ? "red" : 
                         value > 3 ? "darkorange" : 
                         value > 2 ? "orange" : 
                         value > 1 ? "purple" : 
                         value > 0 ? "blue" : "green";
                })
            filters:
              - filter: i >0
        layout:
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 12
                  step: hour
                - count: 1
                  step: day
                - count: 7
                  step: day
                - count: 1
                  step: month
                - count: 3
                  step: month
                - count: 1
                  step: year
      - type: custom:plotly-graph
        hours_to_show: 31d
        title: Battery discharge
        refresh_interval: auto
        entities:
          - entity: sensor.solarman_daily_battery_discharge
            name: Charge
            unit_of_measurement: kWh
            texttemplate: '%{y}'
            type: bar
            statistic: state
            period: day
            marker:
              color: |-
                $ex ys.map(y => {
                  let value = parseFloat(y.toFixed(2));
                  return value > 5 ? "darkred" : 
                         value > 4 ? "red" : 
                         value > 3 ? "darkorange" : 
                         value > 2 ? "orange" : 
                         value > 1 ? "purple" : 
                         value > 0 ? "blue" : "green";
                })
            filters:
              - filter: i >0
        layout:
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 12
                  step: hour
                - count: 1
                  step: day
                - count: 7
                  step: day
                - count: 1
                  step: month
                - count: 3
                  step: month
                - count: 1
                  step: year
    title: Invertert
    icon: mdi:amplifier
    badges:
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        color: ''
        entity: switch.sw1
        name: Sw1
        icon: mdi:electric-switch
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        color: ''
        entity: switch.sw2
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        entity: switch.ininverter
        name: Grid
        icon: mdi:connection
  - title: AC
    path: ac
    icon: mdi:air-conditioner
    badges: []
    cards:
      - features:
          - style: icons
            type: climate-preset-modes
            preset_modes:
              - Power 50
              - Power 75
              - Power 100
        type: tile
        features_position: bottom
        vertical: false
        entity: climate.ac_sala_wifi
        name: Sala
        grid_options:
          columns: 9
          rows: 2
        show_entity_picture: false
      - type: vertical-stack
        cards:
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-entity-card
                entity: switch.ac_sala_wifi_high_power_mode
                icon_color: red
                layout: horizontal
                name: HP
                icon: mdi:power-socket
            columns: 1
          - type: custom:bar-card
            title: Power
            style: |-
              bar-card-value {
                margin-right: auto;
                font-size: 20px;
                font-weight: bold;
                text-shadow: 1px 1px #0005;
              }
            positions:
              indicator: outside
              name: inside
            animation:
              state: 'true'
              speed: 3
            severity:
              - color: Orange
                from: 650
                to: 1000
              - color: Red
                from: 1000
                to: 2000
              - color: Green
                from: 0
                to: 650
              - hide: null
                from: -5
                to: 5
            entities:
              - entity: sensor.acsala_power
                name: Sala
                max: '1800'
                icon: mdi:air-conditioner
              - entity: sensor.acscala_power
                name: Scala
                max: '1800'
                icon: mdi:air-conditioner
              - entity: sensor.battery_net_power
                name: Battery
                min: '-1000'
                max: '1500'
                icon: mdi:battery
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-template-card
                primary: switch A
                secondary: '{{is_state(''switch.sw1'', "on")  | iif("Batteria", "Enel") }}'
                icon: >
                  {{ is_state('switch.sw1', "on")  |
                  iif("mdi:electric-switch-closed", "mdi:electric-switch") }}
                entity: switch.sw1
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: ''
                badge_color: ''
                color: |
                  {{ is_state('switch.sw1', "on") | iif("blue", "yellow") }}
                features_position: bottom
              - type: custom:mushroom-template-card
                primary: switch B
                secondary: '{{is_state(''switch.sw2'', "on")  | iif("Batteria", "Enel") }}'
                icon: >
                  {{ is_state('switch.sw2', "on") |
                  iif("mdi:electric-switch-closed", "mdi:electric-switch") }}
                entity: switch.sw2
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: ''
                badge_color: ''
                color: |
                  {{ is_state('switch.sw2', "on") | iif("blue", "yellow") }}
                features_position: bottom
              - type: custom:mushroom-template-card
                primary: '{{states.sensor.acsala_power.state}} W'
                secondary: 'AC Sala: {{states.switch.acsala.state | upper}}'
                icon: mdi:air-conditioner
                entity: switch.acsala
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: >-
                  {{is_state('switch.sw1', "on")  | iif("mdi:battery-plus",
                  "mdi:transmission-tower-import") }}
                double_tap_action:
                  action: toggle
                badge_color: '{{is_state(''switch.sw1'', "on")  | iif("blue", "yellow") }}'
                color: >
                  {{ (states("sensor.acsala_power")|float(0) > 10) |
                  iif("green", "red") }}
                features_position: bottom
              - type: custom:mushroom-template-card
                primary: '{{states.sensor.acscala_power.state}} W'
                secondary: 'AC Scala: {{states.switch.acscala.state | upper}}'
                icon: mdi:air-conditioner
                entity: switch.acscala
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: >-
                  {{is_state('switch.sw2', "on")  | iif("mdi:battery-plus",
                  "mdi:transmission-tower-import") }}
                double_tap_action:
                  action: toggle
                badge_color: '{{is_state(''switch.sw2'', "on")  | iif("blue", "yellow") }}'
                color: >
                  {{ (states("sensor.acscala_power")|float(0) > 10) |
                  iif("green", "red") }}
                features_position: bottom
              - type: custom:mushroom-template-card
                primary: '{{states.sensor.battery_out_power.state}} W'
                secondary: OUT Inverter
                icon: mdi:generator-mobile
                entity: sensor.battery_out_power
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: ''
                badge_color: ''
                color: >
                  {{ (states("sensor.battery_out_power")|float(0) > 0) |
                  iif("purple", "") }}
                vertical: true
                features_position: bottom
              - type: custom:mushroom-template-card
                primary: '{{states.sensor.ininverter_power.state}} W'
                secondary: IN Inverter
                icon: mdi:current-ac
                entity: switch.ininverter
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: ''
                badge_color: ''
                color: >
                  {{ (states("sensor.ininverter_power")|float(0) > 0) |
                  iif("green", "") }}
                vertical: true
                features_position: bottom
              - type: custom:mushroom-template-card
                primary: '{{states.sensor.generaleswitch_power.state}} W'
                secondary: Generale Switch
                icon: mdi:dip-switch
                entity: switch.generaleswitch
                multiline_secondary: true
                tap_action:
                  action: more-info
                badge_icon: ''
                badge_color: ''
                color: >
                  {{ (states("sensor.generaleswitch_power")|float(0) > 0) |
                  iif("red", "") }}
                vertical: true
                features_position: bottom
            columns: 2
          - type: history-graph
            entities:
              - entity: switch.ininverter
                name: Battery In
              - entity: switch.sw1
                name: A
              - entity: switch.sw2
                name: B
              - entity: binary_sensor.ac_sala_function
                name: Sala
              - entity: switch.ac_sala_wifi_high_power_mode
                name: HiPower
              - entity: switch.fan
                name: Bagno
            hours_to_show: 16
          - square: false
            title: Temperature
            type: grid
            cards:
              - type: custom:mushroom-entity-card
                primary_info: state
                secondary_info: name
                name: Home
                icon_color: purple
                entity: sensor.home_temperature
              - type: custom:mushroom-entity-card
                primary_info: state
                secondary_info: name
                icon_color: green
                entity: input_number.temp_out_saved
                name: Out
                icon: mdi:temperature-celsius
              - type: custom:mushroom-entity-card
                primary_info: state
                secondary_info: name
                icon_color: red
                icon: ''
                entity: input_number.temp2previuous
                name: Mandata
              - type: custom:mushroom-entity-card
                primary_info: state
                secondary_info: name
                icon_color: light-blue
                entity: input_number.temp1previous
                icon: ''
                name: Ritorno
              - type: custom:mushroom-entity-card
                primary_info: state
                secondary_info: name
                icon_color: lime
                icon: mdi:delta
                entity: sensor.delta_temp
                name: Delta
              - type: custom:mushroom-entity-card
                primary_info: state
                secondary_info: name
                icon_color: white
                icon: mdi:current-ac
                entity: sensor.acsala_voltage
                name: Voltage
            columns: 2
      - type: vertical-stack
        title: Charts
        cards:
          - type: custom:plotly-graph
            entities:
              - entity: sensor.acsala_power
                name: Sala
              - entity: sensor.acscala_power
                name: Scala
            title: ACs
            logarithmic_scale: false
            hours_to_show: 16
            refresh_interval: 10
            autorange_after_scroll: true
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 180
                      step: minute
                    - count: 8
                      step: hour
                    - count: 16
                      step: hour
                    - count: 2
                      step: day
                    - count: 7
                      step: day
          - type: custom:plotly-graph
            entities:
              - entity: sensor.temperature1
                name: Ritorno
              - entity: sensor.temperature2
                name: Mandata
              - entity: sensor.delta_temp
                name: Delta
            title: AC Temp
            logarithmic_scale: false
            hours_to_show: 16
            refresh_interval: 10
            autorange_after_scroll: true
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 3
                      step: hour
                    - count: 16
                      step: hour
                    - count: 36
                      step: hour
                    - count: 4
                      step: day
                    - count: 10
                      step: day
      - type: vertical-stack
        title: Energy
        cards:
          - square: false
            type: grid
            cards:
              - type: statistic
                entity: sensor.acsala_energy
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Sala
              - type: statistic
                entity: sensor.acscala_energy
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Scala
              - type: statistic
                entity: sensor.ac_total_energy
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Total
            columns: 3
          - type: entities
            entities:
              - entity: sensor.acsala_energy_counter_week
                name: Weekly
              - entity: sensor.acsala_energy_counter_month
                name: Monthly
              - entity: sensor.acsala_energy_counter_quarter
                name: Quarter
              - entity: sensor.acsala_energy_counter_year
                name: Year
                secondary_info: none
            state_color: true
            title: AC Sala
          - chart_type: bar
            period: day
            type: statistics-graph
            entities:
              - entity: sensor.acsala_energy
                name: Sala
              - entity: sensor.acscala_energy
                name: Scala
            hide_legend: false
            days_to_show: 30
            title: AC Energy
            stat_types:
              - change
          - square: false
            title: Battery Energy
            type: grid
            cards:
              - type: statistic
                entity: sensor.battery_out_energy_integral
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                icon: mdi:battery-negative
              - type: statistic
                entity: sensor.battery_out_energy_integral
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:battery-negative
              - type: statistic
                entity: sensor.battery_out_energy_integral
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:battery-negative
              - type: statistic
                entity: sensor.battery_in_energy_integral
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                icon: mdi:battery-positive
              - type: statistic
                entity: sensor.battery_in_energy_integral
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:battery-positive
              - type: statistic
                entity: sensor.battery_in_energy_integral
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:battery-positive
              - type: statistic
                entity: sensor.battery_net_energy_integral
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                icon: mdi:battery
              - type: statistic
                entity: sensor.battery_net_energy_integral
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:battery
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:battery
                entity: sensor.battery_net_energy_integral
            columns: 3
          - chart_type: bar
            period: day
            type: statistics-graph
            entities:
              - sensor.battery_net_energy_integral
            hide_legend: true
            days_to_show: 30
            stat_types:
              - change
            title: Battery Net
      - type: vertical-stack
        title: Charts 24h
        cards:
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.acsala_current
                name: Current
              - entity: sensor.acscala_current
                name: Scala
                color: green
            hours_to_show: 24
            points_per_hour: 12
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            color_thresholds:
              - value: 1
                color: '#395ce6'
              - color: '#cce639'
              - value: 5
                color: '#ff0000'
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.acsala_voltage
                name: Voltage
              - entity: sensor.acscala_voltage
                name: Scala
            hours_to_show: 24
            points_per_hour: 12
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.acsala_device_temperature
                name: Device Temp
              - entity: sensor.acscala_device_temperature
                name: Scala
            hours_to_show: 24
            points_per_hour: 12
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
  - title: Riscaldamento
    path: riscaldamento
    icon: mdi:heating-coil
    badges:
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.home_temperature
        name: Sala
        icon: mdi:home-thermometer-outline
        color: ''
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.cucina_temp_temperature
        color: lime
        name: Cucina
        icon: mdi:countertop-outline
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.bagno_temp_temperature
        color: deep-orange
        name: Bagno
        icon: mdi:toilet
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: input_number.temp_out_saved
        name: Fuori
        color: purple
        icon: mdi:thermometer
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        entity: sensor.rack_temperature
        name: Sotto
        icon: mdi:sun-thermometer-outline
        color: teal
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        icon: mdi:water-percent
        color: light-blue
        entity: sensor.home_humidity
        name: Hum
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        entity: sensor.home_temp_derivate
        icon: mdi:chart-bell-curve-cumulative
        color: amber
    cards:
      - type: vertical-stack
        title: Charts
        cards:
          - type: custom:apexcharts-card
            graph_span: 1d
            header:
              show: true
              title: Casa
              show_states: true
              colorize_states: true
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.home_temperature
                name: Sala
                group_by:
                  func: avg
                  duration: 1h
                show:
                  extremas: true
              - entity: sensor.bagno_temp_temperature
                name: Bagno
                group_by:
                  func: avg
                  duration: 1h
              - entity: sensor.cucina_temp_temperature
                name: Cucina
                color: yellow
                group_by:
                  func: avg
                  duration: 1h
          - type: custom:apexcharts-card
            graph_span: 1d
            header:
              show: true
              title: Sala
              show_states: true
              colorize_states: true
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.home_temperature
                name: Today
                show:
                  extremas: true
              - entity: sensor.home_temperature
                offset: '-1d'
                name: Yesterday
              - entity: sensor.home_temperature
                offset: '-2d'
                name: 2 Days ago
                color: yellow
          - type: custom:apexcharts-card
            graph_span: 1d
            header:
              show: true
              title: Out
              show_states: true
              colorize_states: true
            apex_config:
              legend:
                show: false
            series:
              - entity: input_number.temp_out_saved
                name: Today
                group_by:
                  func: avg
                  duration: 1h
                show:
                  extremas: true
              - entity: input_number.temp_out_saved
                offset: '-1d'
                name: Yesterday
                group_by:
                  func: avg
                  duration: 1h
              - entity: input_number.temp_out_saved
                offset: '-2d'
                name: '-2d'
                color: yellow
                group_by:
                  func: avg
                  duration: 1h
          - type: custom:apexcharts-card
            graph_span: 1d
            header:
              show: true
              title: Bagno
              show_states: true
              colorize_states: true
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.bagno_temp_temperature
                name: Today
                group_by:
                  func: avg
                  duration: 1h
                show:
                  extremas: true
              - entity: sensor.bagno_temp_temperature
                offset: '-1d'
                name: Yesterday
                group_by:
                  func: avg
                  duration: 1h
              - entity: sensor.bagno_temp_temperature
                offset: '-2d'
                name: '-2d'
                color: yellow
                group_by:
                  func: avg
                  duration: 1h
          - type: custom:apexcharts-card
            graph_span: 1d
            header:
              show: true
              title: Cucina
              show_states: true
              colorize_states: true
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.cucina_temp_temperature
                name: Today
                group_by:
                  func: avg
                  duration: 1h
                show:
                  extremas: true
              - entity: sensor.cucina_temp_temperature
                offset: '-1d'
                name: Yesterday
                group_by:
                  func: avg
                  duration: 1h
              - entity: sensor.cucina_temp_temperature
                offset: '-2d'
                name: '-2d'
                color: yellow
                group_by:
                  func: avg
                  duration: 1h
      - type: custom:plotly-graph
        entities:
          - entity: sensor.home_temperature
          - entity: sensor.cucina_temp_temperature
          - entity: sensor.bagno_temp_temperature
        title: Temperature
        logarithmic_scale: false
        hours_to_show: 24
        refresh_interval: 10
        autorange_after_scroll: true
        layout:
          height: 600
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 8
                  step: hour
                - count: 24
                  step: hour
                - count: 72
                  step: hour
                - count: 7
                  step: day
      - type: vertical-stack
        title: Week
        cards:
          - type: custom:vertical-stack-in-card
            cards:
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.home_temperature
                    name: Home
                hours_to_show: 168
                line_width: 3
                font_size: 100
                animate: true
                cache: true
                color_thresholds:
                  - value: 18
                    color: '#395ce6'
                  - color: '#39e692'
                  - color: '#cce639'
                  - value: 23
                    color: '#ff0000'
                show:
                  name: true
                  icon: false
                  state: false
                  legend: false
                  fill: fade
                  extrema: true
              - type: custom:mini-graph-card
                entities:
                  - entity: input_number.temp_out_saved
                    name: Out
                hours_to_show: 168
                line_width: 3
                font_size: 100
                group_by: hour
                animate: true
                cache: true
                color_thresholds:
                  - value: 0
                    color: '#395ce6'
                  - color: '#39e692'
                  - color: '#cce639'
                  - value: 25
                    color: '#ff0000'
                show:
                  name: true
                  icon: false
                  state: false
                  legend: false
                  fill: fade
                  extrema: true
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.home_humidity
                    name: Humidity
                hours_to_show: 168
                line_width: 3
                font_size: 100
                group_by: hour
                animate: true
                cache: true
                color_thresholds:
                  - value: 50
                    color: '#395ce6'
                  - color: '#39e692'
                  - color: '#cce639'
                  - value: 80
                    color: '#ff0000'
                show:
                  name: true
                  icon: false
                  state: false
                  legend: false
                  fill: fade
                  extrema: true
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.bagno_temp_humidity
                    name: Humidity bagno
                hours_to_show: 168
                line_width: 3
                font_size: 100
                group_by: hour
                animate: true
                cache: true
                color_thresholds:
                  - value: 50
                    color: '#395ce6'
                  - color: '#39e692'
                  - color: '#cce639'
                  - value: 80
                    color: '#ff0000'
                show:
                  name: true
                  icon: false
                  state: false
                  legend: false
                  fill: fade
                  extrema: true
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.rack_temperature
                    name: Floor00
                hours_to_show: 168
                line_width: 3
                font_size: 100
                group_by: hour
                animate: true
                cache: true
                color_thresholds:
                  - value: 0
                    color: '#395ce6'
                  - color: '#39e692'
                  - color: '#cce639'
                  - value: 25
                    color: '#ff0000'
                show:
                  name: true
                  icon: false
                  state: false
                  legend: false
                  fill: fade
                  extrema: true
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.home_temp_derivate
                    name: Derivate
                    color: yellow
                hours_to_show: 168
                points_per_hour: 2
                line_width: 3
                font_size: 100
                animate: true
                cache: true
                show:
                  name: true
                  icon: false
                  state: false
                  legend: false
                  fill: fade
                  extrema: true
      - type: vertical-stack
        title: History
        cards:
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.home_temperature
                name: Home History
            hours_to_show: 600
            line_width: 3
            font_size: 100
            group_by: hour
            height: 200
            animate: true
            cache: true
            color_thresholds:
              - value: 18
                color: '#395ce6'
              - color: '#39e692'
              - color: '#cce639'
              - value: 23
                color: '#ff0000'
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
          - type: custom:mini-graph-card
            entities:
              - entity: input_number.temp_out_saved
                name: Out History
            hours_to_show: 600
            line_width: 3
            font_size: 100
            group_by: hour
            height: 200
            animate: true
            cache: true
            color_thresholds:
              - value: 0
                color: '#395ce6'
              - color: '#39e692'
              - color: '#cce639'
              - value: 25
                color: '#ff0000'
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
  - title: Appliances
    icon: mdi:connection
    badges: []
    cards: []
    type: sections
    sections:
      - type: grid
        cards:
          - type: vertical-stack
            title: Boiler Room
            cards:
              - type: grid
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.boiler
                    primary_info: state
                    secondary_info: name
                    name: Boiler
                    icon: mdi:water-boiler
                    icon_color: primary
                  - type: custom:mushroom-entity-card
                    entity: switch.washmachine
                    icon: mdi:washing-machine
                    primary_info: state
                    secondary_info: name
                    name: Lavatrice
                    icon_color: blue
                  - type: custom:mushroom-entity-card
                    entity: sensor.boiler_status
                    primary_info: state
                    secondary_info: name
                    name: Boiler
                    icon: mdi:water-boiler
                    icon_color: yellow
                  - type: custom:mushroom-entity-card
                    entity: sensor.front_load_washer_current_course
                    icon: mdi:washing-machine
                    primary_info: state
                    secondary_info: name
                    name: Stato
                    icon_color: purple
              - type: custom:bar-card
                entities:
                  - entity: sensor.boiler_power
                    name: Boiler
                    icon: mdi:water-boiler
                    max: '1500'
                  - entity: sensor.washmachine_power
                    icon: mdi:washing-machine
                    name: Lavatrice
                    max: '2500'
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.boiler_power
                    name: Boiler
                  - entity: sensor.washmachine_power
                    name: Lavatrice
                title: Boiler Room
                logarithmic_scale: false
                hours_to_show: 12
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 400
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 180
                          step: minute
                        - count: 8
                          step: hour
                        - count: 16
                          step: hour
                        - count: 2
                          step: day
                        - count: 7
                          step: day
              - type: history-graph
                entities:
                  - entity: sensor.boiler_status
                    name: Boiler
                  - entity: sensor.front_load_washer_current_course
                    name: Lavatrice
                hours_to_show: 12
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                entity: sensor.boiler_energy
                icon: mdi:view-day-outline
              - type: statistic
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:calendar-week
                entity: sensor.boiler_energy
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:calendar-month
                entity: sensor.boiler_energy
            columns: 3
      - type: grid
        cards:
          - type: vertical-stack
            title: Cucina
            cards:
              - type: custom:bar-card
                entities:
                  - entity: sensor.washdisher_power
                    name: Lavastoviglie
                    icon: mdi:dishwasher
                    max: '1500'
                  - entity: sensor.frigo_power
                    icon: mdi:fridge
                    name: Frigo
                    max: '500'
                  - entity: sensor.forno_power
                    icon: mdi:stove
                    name: Forno
                    max: '2500'
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.forno_power
                    name: Forno
                  - entity: sensor.washdisher_power
                    name: Lavastoviglie
                  - entity: sensor.frigo_power
                    nane: Frugo
                title: Boiler Room
                logarithmic_scale: false
                hours_to_show: 12
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 400
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 180
                          step: minute
                        - count: 8
                          step: hour
                        - count: 16
                          step: hour
                        - count: 2
                          step: day
                        - count: 7
                          step: day
              - type: history-graph
                entities:
                  - entity: switch.dishwasher_power
                    name: Lavastoviglie
                  - entity: binary_sensor.frigo_state
                    name: Frigo
                  - entity: binary_sensor.fornostate
                    name: Forno
                hours_to_show: 12
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                entity: sensor.kitchen_energy
                icon: mdi:view-day-outline
              - type: statistic
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:calendar-week
                entity: sensor.kitchen_energy
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:calendar-month
                entity: sensor.kitchen_energy
            columns: 3
      - type: grid
        cards:
          - type: heading
            icon: mdi:dishwasher
            heading: Lavatrice
            heading_style: title
            badges:
              - type: entity
                entity: select.dishwasher_active_program
              - type: entity
                entity: sensor.washer_end_time
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-entity-card
                entity: switch.dishwasher_power
                icon: mdi:power
                primary_info: state
                secondary_info: name
                name: Power
                icon_color: purple
                layout: vertical
            columns: 1
            grid_options:
              columns: 6
              rows: auto
          - type: custom:mushroom-select-card
            entity: select.dishwasher_active_program
            name: Programma
            icon_color: red
            fill_container: false
          - type: entities
            entities:
              - entity: sensor.dishwasher_door
              - entity: sensor.dishwasher_operation_state
              - entity: sensor.dishwasher_rinse_aid_nearly_empty
              - entity: sensor.dishwasher_salt_nearly_empty
          - type: history-graph
            entities:
              - entity: select.dishwasher_active_program
            hours_to_show: 12
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                entity: sensor.lavastoviglie_energy
                icon: mdi:view-day-outline
              - type: statistic
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:calendar-week
                entity: sensor.lavastoviglie_energy
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:calendar-month
                entity: sensor.lavastoviglie_energy
            columns: 3
  - title: Frigate
    path: frigate
    icon: mdi:cctv
    type: sidebar
    badges: []
    cards:
      - square: false
        type: grid
        cards:
          - show_state: false
            show_name: false
            camera_view: live
            type: picture-entity
            image: https://demo.home-assistant.io/stub_config/bedroom.png
            camera_image: camera.192_168_0_105
            entity: camera.192_168_0_105
          - show_state: false
            show_name: false
            camera_view: live
            type: picture-entity
            image: https://demo.home-assistant.io/stub_config/bedroom.png
            camera_image: camera.192_168_0_105
            entity: camera.192_168_0_101
          - show_state: false
            show_name: false
            camera_view: live
            type: picture-entity
            image: https://demo.home-assistant.io/stub_config/bedroom.png
            camera_image: camera.192_168_0_105
            entity: camera.192_168_0_102
          - show_state: false
            show_name: false
            camera_view: live
            type: picture-entity
            image: https://demo.home-assistant.io/stub_config/bedroom.png
            camera_image: camera.192_168_0_105
            entity: camera.192_168_0_103
        columns: 2
      - square: false
        type: grid
        cards:
          - type: vertical-stack
            cards:
              - show_state: true
                show_name: true
                camera_view: auto
                type: picture-entity
                entity: image.entrance_person
          - type: vertical-stack
            cards:
              - show_state: true
                show_name: true
                camera_view: auto
                type: picture-entity
                entity: image.back_person
          - type: vertical-stack
            cards:
              - show_state: true
                show_name: true
                camera_view: auto
                type: picture-entity
                entity: image.garden_person
          - type: vertical-stack
            cards:
              - show_state: true
                show_name: true
                camera_view: auto
                type: picture-entity
                entity: image.garage_person
        columns: 2
      - type: vertical-stack
        cards:
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-entity-card
                entity: input_boolean.person_notification
                icon_color: primary
                fill_container: true
                name: Notification
                double_tap_action:
                  action: toggle
                view_layout:
                  position: sidebar
              - type: custom:mushroom-entity-card
                entity: switch.back_detect
                double_tap_action:
                  action: toggle
              - type: custom:mushroom-entity-card
                entity: switch.garden_detect
                double_tap_action:
                  action: toggle
              - type: custom:mushroom-entity-card
                entity: switch.entrance_detect
                double_tap_action:
                  action: toggle
              - type: custom:mushroom-entity-card
                entity: switch.garage_detect
                double_tap_action:
                  action: toggle
              - type: custom:mushroom-template-card
                primary: Frigate
                secondary: ''
                icon: mdi:cctv
                icon_color: yellow
                tap_action:
                  action: navigate
                  navigation_path: /ccab4aaf_frigate-fa
                fill_container: true
                multiline_secondary: true
            columns: 2
          - type: custom:uptime-card
            entity: binary_sensor.frigate_full_access_running
            icon: mdi:cctv
            bar:
              height: 110
              round: 0
              spacing: 3
              amount: 42
            hours_to_show: 168
            update_interval: 1
            init: {}
            color: {}
            alias:
              ok: Online
              ko: Offline
            show:
              header: true
            tap_action: {}
            tooltip: {}
            blink: {}
            clip: {}
            view_layout:
              position: sidebar
        view_layout:
          position: sidebar
  - path: solar
    icon: mdi:solar-panel-large
    title: Solar
    type: sidebar
    badges: []
    cards:
      - type: vertical-stack
        cards:
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.solar_power
                icon: mdi:solar-power-variant
                primary_info: state
                secondary_info: name
                icon_color: yellow
                name: Power
                layout: vertical
              - type: custom:mushroom-entity-card
                entity: sensor.solar_voltage
                icon: mdi:current-ac
                primary_info: state
                secondary_info: name
                icon_color: cyan
                name: Voltage
                layout: vertical
              - type: custom:mushroom-entity-card
                entity: sensor.solar_energy
                icon: mdi:sun-angle
                primary_info: state
                secondary_info: name
                icon_color: green
                name: Energy
                layout: vertical
              - type: custom:mushroom-entity-card
                entity: sensor.power_production_now
                icon: mdi:solar-power-variant-outline
                primary_info: state
                secondary_info: name
                icon_color: orange
                name: Power Est
                fill_container: true
                layout: vertical
            columns: 4
      - type: custom:plotly-graph
        entities:
          - entity: sensor.solar_power
            name: Sud
          - entity: sensor.solarman_pv1_power
            name: Nord
          - entity: sensor.enel_power
            name: enel
        title: Sorgente
        logarithmic_scale: false
        hours_to_show: 16
        refresh_interval: 10
        autorange_after_scroll: true
        layout:
          height: 700
          xaxis:
            rangeselector:
              'y': 1.2
              buttons:
                - count: 180
                  step: minute
                - count: 8
                  step: hour
                - count: 16
                  step: hour
                - count: 2
                  step: day
                - count: 7
                  step: day
      - square: false
        type: grid
        cards:
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              title: Compare Day
              show_states: false
              colorize_states: true
            graph_span: 24h
            stacked: false
            apex_config:
              legend:
                show: false
            yaxis:
              - min: 0
                max: 5000
                decimals: 0
                apex_config:
                  tickAmount: 5
            series:
              - entity: sensor.solarpoweravg
                name: Now
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-1d'
                name: 1 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-2d'
                name: 2 Day
                type: line
                color: yellow
                group_by:
                  func: avg
                  duration: 10min
        columns: 1
      - type: vertical-stack
        cards:
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.solarderivate
                icon: mdi:sun-wireless
                primary_info: state
                secondary_info: name
                icon_color: yellow
                name: Solar Derivate
              - type: custom:mushroom-entity-card
                entity: sensor.selvahome_solar_irradiance_day_0d
                icon: mdi:solar-power
                primary_info: state
                secondary_info: name
                name: Irradiance
                icon_color: green
              - type: custom:mushroom-entity-card
                entity: sensor.sun_solar_azimuth
                icon: mdi:compass
                primary_info: state
                secondary_info: name
                name: Azimuth
                icon_color: green
              - type: custom:mushroom-entity-card
                entity: sensor.sun_solar_elevation
                icon: mdi:arrow-collapse
                primary_info: state
                secondary_info: name
                name: Elevation
                icon_color: deep-orange
              - type: custom:mushroom-entity-card
                entity: sensor.energy_production_today
                icon: mdi:elevation-rise
                primary_info: state
                secondary_info: name
                name: Energy Est
                icon_color: purple
              - type: custom:mushroom-entity-card
                entity: sensor.energy_production_today_remaining
                icon: mdi:sun-clock
                primary_info: state
                secondary_info: name
                icon_color: blue
                name: Energy Remain
              - type: custom:mushroom-entity-card
                entity: sensor.power_production_now
                icon: mdi:solar-power-variant-outline
                primary_info: state
                secondary_info: name
                icon_color: orange
                name: Power Est
              - type: custom:mushroom-entity-card
                entity: sensor.enel_rssi
                icon: mdi:wifi
                primary_info: state
                secondary_info: name
                icon_color: yellow
                name: WiFi Solar
            columns: 2
          - type: energy-solar-graph
      - type: vertical-stack
        title: Sun
        cards:
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              title: Sun
              show_states: true
              colorize_states: true
            graph_span: 36h
            stacked: true
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.sun_solar_azimuth
                show:
                  extremas: true
                name: Azimuth
                type: line
                group_by:
                  func: avg
                  duration: 15min
              - entity: sensor.sun_solar_elevation
                show:
                  extremas: true
                name: Elevation
                type: line
                group_by:
                  func: avg
                  duration: 15min
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              title: Solar Derivate
              show_states: true
              colorize_states: true
            graph_span: 36h
            stacked: true
            apex_config:
              legend:
                show: true
            series:
              - entity: sensor.solarderivate
                show:
                  extremas: true
                name: Derivate
                color: orange
                type: line
                group_by:
                  func: avg
                  duration: 15min
        view_layout:
          position: sidebar
      - type: vertical-stack
        cards:
          - square: false
            type: grid
            title: Enel Time
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.minus3kwenel_on_duration
                icon: mdi:transmission-tower-export
                primary_info: state
                secondary_info: name
                icon_color: purple
                name: '- 3kW'
              - type: custom:mushroom-entity-card
                entity: sensor.minus2kwenel_on_duration
                icon: mdi:transmission-tower-export
                primary_info: state
                secondary_info: name
                icon_color: indigo
                name: '- 2kW'
              - type: custom:mushroom-entity-card
                entity: sensor.minus1kwenel_on_duration
                icon: mdi:transmission-tower-export
                primary_info: state
                secondary_info: name
                icon_color: blue
                name: '- 1 kW'
              - type: custom:mushroom-entity-card
                entity: sensor.minus05kwenel_on_duration
                icon: mdi:transmission-tower-export
                primary_info: state
                secondary_info: name
                icon_color: cyan
                name: '- 0.5 kW '
              - type: custom:mushroom-entity-card
                entity: sensor.minus00_05kwenel_on_duration
                icon: mdi:transmission-tower-export
                primary_info: state
                secondary_info: name
                icon_color: green
                name: '- 0.0 kW'
              - type: custom:mushroom-entity-card
                entity: sensor.plus_00_05_kw_enel_on_duration_2
                icon: mdi:transmission-tower-import
                primary_info: state
                secondary_info: name
                icon_color: light-green
                name: + 0.0 kW
              - type: custom:mushroom-entity-card
                entity: sensor.plus05kwenel_on_duration
                icon: mdi:transmission-tower-import
                primary_info: state
                secondary_info: name
                icon_color: amber
                name: + 0.5kW
              - type: custom:mushroom-entity-card
                entity: sensor.plus1kwenel_on_duration
                icon: mdi:transmission-tower-import
                primary_info: state
                secondary_info: name
                icon_color: orange
                name: + 1kW
              - type: custom:mushroom-entity-card
                entity: sensor.plus2kwenel_on_duration
                icon: mdi:transmission-tower-import
                primary_info: state
                secondary_info: name
                icon_color: red
                name: + 2kW
              - type: custom:mushroom-entity-card
                entity: sensor.plus3kwenel_on_duration
                icon: mdi:transmission-tower-import
                primary_info: state
                secondary_info: name
                icon_color: accent
                name: + 3kW
            columns: 2
      - square: false
        type: grid
        cards:
          - type: custom:plotly-graph
            raw_plotly_config: true
            hours_to_show: 32h
            entities:
              - entity: sensor.sun_solar_azimuth
                internal: true
                period: 5minute
                fn: >-
                  $fn ({ xs, ys, vars }) => { vars.azimuth_raw_y = ys;
                  vars.azimuth_raw_x =   xs.map(x => x.getTime());  }
              - entity: sensor.sun_solar_elevation
                internal: true
                period: 5minute
                fn: >-
                  $fn ({ xs, ys, vars }) => { vars.elevation_raw_y = ys;
                  vars.elevation_raw_x = xs.map(x => x.getTime());  }
              - entity: sensor.solar_power
                internal: true
                period: 5minute
                fn: >-
                  $fn ({ xs, ys, vars }) => { vars.power_raw_y = ys; 
                  vars.power_raw_x = xs.map(x => x.getTime());  }
              - entity: ''
                fn: |
                  $fn ({ xs, ys, vars }) => {
                      // choose spacing, not every value works somehow
                      const dx = 8;
                      const dy = 5;
                      
                      // first construct the heatmap arrays x,y,z 
                      //                           RANGE                     // START
                      const x = Array.from({length: (270/dx)+1 }, (e, i) =>  40 +  dx*i).map(x=>x);
                      const y = Array.from({length: (60/dy)+1 }, (e, i) => -0+dy*i).map(x=>x);
                      let z   = Array(y.length).fill(null).map(() => Array(x.length).fill(NaN));
                      
                      // we want to take care of every power value 
                      for (let i = 0; i < vars.power_raw_y.length; i++) {
                          let pw = vars.power_raw_y[i];
                          let ix = vars.power_raw_x[i];

                          // because the power is NAN at night, the arrays are not the 
                          // same length, so we have to time sync:
                          azi = vars.azimuth_raw_x.indexOf(ix)
                          eli = vars.elevation_raw_x.indexOf(ix)

                          if ((azi>=0)&(eli>=0)){
                            let az = vars.azimuth_raw_y[azi];
                            let el = vars.elevation_raw_y[eli];;
                            
                            // sort this in in the heatmap:
                            pos_az = x.indexOf(Math.round(az/dx)*dx);
                            pos_el = y.indexOf(Math.round(el/dy)*dy);
                            
                            if ((pos_az>=0)&(pos_el>=0)){
                              if (isNaN(z[pos_el][pos_az])){
                                 z[pos_el][pos_az] = pw
                              } else {
                                 z[pos_el][pos_az] = Math.max(z[pos_el][pos_az], pw)
                              }
                            }
                          }
                      }
                      vars.x = x;
                      vars.y = y;
                      vars.z = z;
                    };
                x: $fn ({ vars }) => vars.x
                'y': $fn ({ vars }) => vars.y
                z: $fn ({ vars }) => vars.z
                type: heatmap
                hoverongaps: false
            title: Sud [W]
            layout:
              height: 300
              margin:
                t: 0
                b: 45
                l: 45
                r: 40
              yaxis:
                title: Elevation[°]
              xaxis:
                title: Azimuth [°]
          - type: custom:plotly-graph
            raw_plotly_config: true
            hours_to_show: 32h
            entities:
              - entity: sensor.sun_solar_azimuth
                internal: true
                period: 5minute
                fn: >-
                  $fn ({ xs, ys, vars }) => { vars.azimuth_raw_y = ys;
                  vars.azimuth_raw_x =   xs.map(x => x.getTime());  }
              - entity: sensor.sun_solar_elevation
                internal: true
                period: 5minute
                fn: >-
                  $fn ({ xs, ys, vars }) => { vars.elevation_raw_y = ys;
                  vars.elevation_raw_x = xs.map(x => x.getTime());  }
              - entity: sensor.solarman_pv1_power
                internal: true
                period: 5minute
                fn: >-
                  $fn ({ xs, ys, vars }) => { vars.power_raw_y = ys; 
                  vars.power_raw_x = xs.map(x => x.getTime());  }
              - entity: ''
                fn: |
                  $fn ({ xs, ys, vars }) => {
                      // choose spacing, not every value works somehow
                      const dx = 8;
                      const dy = 5;
                      
                      // first construct the heatmap arrays x,y,z 
                      //                           RANGE                     // START
                      const x = Array.from({length: (270/dx)+1 }, (e, i) =>  40 +  dx*i).map(x=>x);
                      const y = Array.from({length: (60/dy)+1 }, (e, i) => -0+dy*i).map(x=>x);
                      let z   = Array(y.length).fill(null).map(() => Array(x.length).fill(NaN));
                      
                      // we want to take care of every power value 
                      for (let i = 0; i < vars.power_raw_y.length; i++) {
                          let pw = vars.power_raw_y[i];
                          let ix = vars.power_raw_x[i];

                          // because the power is NAN at night, the arrays are not the 
                          // same length, so we have to time sync:
                          azi = vars.azimuth_raw_x.indexOf(ix)
                          eli = vars.elevation_raw_x.indexOf(ix)

                          if ((azi>=0)&(eli>=0)){
                            let az = vars.azimuth_raw_y[azi];
                            let el = vars.elevation_raw_y[eli];;
                            
                            // sort this in in the heatmap:
                            pos_az = x.indexOf(Math.round(az/dx)*dx);
                            pos_el = y.indexOf(Math.round(el/dy)*dy);
                            
                            if ((pos_az>=0)&(pos_el>=0)){
                              if (isNaN(z[pos_el][pos_az])){
                                 z[pos_el][pos_az] = pw
                              } else {
                                 z[pos_el][pos_az] = Math.max(z[pos_el][pos_az], pw)
                              }
                            }
                          }
                      }
                      vars.x = x;
                      vars.y = y;
                      vars.z = z;
                    };
                x: $fn ({ vars }) => vars.x
                'y': $fn ({ vars }) => vars.y
                z: $fn ({ vars }) => vars.z
                type: heatmap
                hoverongaps: false
            title: Nord [W]
            layout:
              height: 300
              margin:
                t: 0
                b: 45
                l: 45
                r: 40
              yaxis:
                title: Elevation[°]
              xaxis:
                title: Azimuth [°]
        columns: 1
      - type: vertical-stack
        title: Solar
        cards:
          - square: false
            type: grid
            title: Solar Time
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.05kwsolar_on_duration
                icon: mdi:sun-wireless
                primary_info: state
                secondary_info: name
                icon_color: indigo
                name: 0.5kW duration
              - type: custom:mushroom-entity-card
                entity: sensor.1kwsolar_on_duration
                icon: mdi:sun-wireless
                primary_info: state
                secondary_info: name
                icon_color: light-blue
                name: 1kW duration
              - type: custom:mushroom-entity-card
                entity: sensor.2kwsolar_on_duration
                icon: mdi:sun-wireless
                primary_info: state
                secondary_info: name
                icon_color: teal
                name: 2kW duration
              - type: custom:mushroom-entity-card
                entity: sensor.3kwsolar_on_duration
                icon: mdi:sun-wireless
                primary_info: state
                secondary_info: name
                icon_color: yellow
                name: 3kW duration
              - type: custom:mushroom-entity-card
                entity: sensor.4kwsolar_on_duration_2
                icon: mdi:sun-wireless
                primary_info: state
                secondary_info: name
                icon_color: accent
                name: 4kW duration
            columns: 2
          - square: false
            type: grid
            title: Stage Time
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.4kwsolar_on_duration
                icon: mdi:sun-clock-outline
                primary_info: state
                secondary_info: name
                icon_color: yellow
                name: firstStage duration
              - type: custom:mushroom-entity-card
                entity: sensor.combosecondstage_on_duration
                icon: mdi:sun-clock-outline
                primary_info: state
                secondary_info: name
                icon_color: blue
                name: Second Stage duration
              - type: custom:mushroom-entity-card
                entity: sensor.combothirdstage_on_duration
                icon: mdi:sun-clock-outline
                primary_info: state
                secondary_info: name
                icon_color: red
                name: Third Stage duration
            columns: 3
      - square: false
        type: grid
        cards:
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              title: Compare Day
              show_states: false
              colorize_states: true
            graph_span: 24h
            stacked: false
            apex_config:
              legend:
                show: false
            yaxis:
              - min: 0
                max: 2500
                decimals: 0
                apex_config:
                  tickAmount: 5
            series:
              - entity: sensor.solarman_pv1_power
                name: Now
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarman_pv1_power
                offset: '-1d'
                name: 1 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarman_pv1_power
                offset: '-2d'
                name: 2 Day
                type: line
                color: yellow
                group_by:
                  func: avg
                  duration: 10min
        columns: 1
  - title: Energy
    path: energy
    icon: mdi:home-lightning-bolt-outline
    type: sidebar
    cards:
      - type: vertical-stack
        cards:
          - type: vertical-stack
            title: Giornaliero
            cards:
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.consume_month
                days_to_show: 30
                title: Total Energy
                hide_legend: true
                stat_types:
                  - change
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - entity: sensor.enel_energy
                    name: Buy
                  - entity: sensor.enel_energy_returned
                    name: Sell
                stat_types:
                  - change
                days_to_show: 30
                title: Enel
                hide_legend: false
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - entity: sensor.solar_energy
                    name: Solar
                stat_types:
                  - change
                days_to_show: 30
                title: Solar South
                hide_legend: true
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.solarman_daily_production
                hide_legend: false
                days_to_show: 30
                stat_types:
                  - max
                title: Solar North
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.boiler_resistance_duration
                  - sensor.boiler_heat_pump_duration
                  - sensor.boiler_pump_resistance_duration
                hide_legend: false
                days_to_show: 30
                stat_types:
                  - max
                title: Duration Boiler
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.boiler_energy
                hide_legend: true
                days_to_show: 30
                title: BoilerEnergy
                stat_types:
                  - change
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.ac_scala_on_duration
                  - sensor.ac_sala_on_duration
                hide_legend: false
                days_to_show: 30
                title: AC time
                stat_types:
                  - max
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.ac_total_energy
                hide_legend: false
                days_to_show: 30
                title: AC energy
                stat_types:
                  - change
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.battery_net_energy_integral
                  - sensor.solarman_daily_battery_charge
                hide_legend: true
                days_to_show: 30
                title: Battery energy
                stat_types:
                  - change
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.05kwsolar_on_duration
                  - sensor.1kwsolar_on_duration
                  - sensor.3kwsolar_on_duration
                hide_legend: false
                days_to_show: 30
                stat_types:
                  - max
                title: Duration 1kW
              - chart_type: line
                period: day
                type: statistics-graph
                entities:
                  - sensor.shelly_h_t_floor01_temperature_2
                  - sensor.home_temperature
                hide_legend: true
                days_to_show: 30
                stat_types:
                  - max
                  - min
                  - mean
                title: Home Temperature
              - chart_type: line
                period: day
                type: statistics-graph
                entities:
                  - sensor.washmachine_energy
                  - sensor.frigo_energy
                  - sensor.forno_energy
                  - sensor.washdisher_energy
                  - sensor.lavastoviglie_energy
                hide_legend: false
                days_to_show: 30
                stat_types:
                  - change
                title: Loads energy
      - type: vertical-stack
        cards:
          - type: vertical-stack
            title: Today
            cards:
              - type: entities
                entities:
                  - entity: sensor.consume_day
                    name: Day
                  - entity: sensor.consume_week
                    name: Week
                  - entity: sensor.consume_month
                    name: Month
                  - entity: sensor.consume_quarter
                    name: Quarter
                  - entity: sensor.consume_year
                    name: Year
                title: Enel consume
              - type: entities
                entities:
                  - entity: sensor.acsala_energy_counter_week
                    name: Weekly
                  - entity: sensor.acsala_energy_counter_month
                    name: Monthly
                  - entity: sensor.acsala_energy_counter_quarter
                    name: Quarter
                  - entity: sensor.acsala_energy_counter_year
                    name: Year
                    secondary_info: none
                state_color: true
                title: AC Sala
              - square: false
                type: grid
                title: Battery Total Energy
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.battery_in_energy_integral
                    icon: mdi:battery-charging-70
                    primary_info: state
                    secondary_info: name
                    icon_color: blue
                    name: In
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    entity: sensor.battery_out_energy_integral
                    icon: mdi:battery-low
                    primary_info: state
                    secondary_info: name
                    icon_color: accent
                    name: Out
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    entity: sensor.battery_net_energy_integral
                    icon: mdi:battery
                    primary_info: state
                    secondary_info: name
                    icon_color: lime
                    name: Net
                    layout: vertical
                columns: 3
        view_layout:
          position: sidebar
      - type: vertical-stack
        cards:
          - type: vertical-stack
            title: Mensile
            cards:
              - chart_type: bar
                period: month
                type: statistics-graph
                entities:
                  - entity: sensor.enel_energy
                    name: Buy
                  - entity: sensor.enel_energy_returned
                    name: Sell
                stat_types:
                  - change
                days_to_show: 365
                title: Enel
                hide_legend: false
              - chart_type: bar
                period: month
                type: statistics-graph
                entities:
                  - entity: sensor.solar_energy
                    name: Solar
                stat_types:
                  - change
                days_to_show: 365
                title: Solar
                hide_legend: true
              - chart_type: bar
                period: month
                type: statistics-graph
                entities:
                  - sensor.home_total_power_2
                days_to_show: 365
                hide_legend: true
                stat_types:
                  - mean
                title: Total power mean
  - title: Workstation
    path: workstation
    icon: mdi:desktop-classic
    badges: []
    cards:
      - type: vertical-stack
        title: Workstation
        cards:
          - square: true
            type: grid
            cards:
              - type: gauge
                entity: sensor.load_1m
                unit: '%'
                max: 5
                min: 1
                needle: true
                severity:
                  green: 0
                  yellow: 2
                  red: 3.5
              - type: gauge
                entity: sensor.load_5m
                unit: '%'
                max: 5
                min: 1
                needle: true
                severity:
                  green: 0
                  yellow: 2
                  red: 3.5
              - type: gauge
                entity: sensor.load_15m
                unit: '%'
                max: 5
                min: 1
                needle: true
                severity:
                  green: 0
                  yellow: 2
                  red: 3.5
            columns: 3
          - type: custom:bar-card
            entities:
              - entity: sensor.processor_use
                name: CPU
              - entity: sensor.memory_use_percent
                name: RAM %
              - entity: sensor.memory_use
                name: RAM
                min: '0'
                max: '6000'
              - entity: sensor.disk_use
                name: Disk
                min: '0'
                max: '756'
              - entity: sensor.disk_use_percent_config
                name: Disk %
              - entity: sensor.rack_temperature_2
                name: Rack temp
              - entity: sensor.rackpower_power
                name: Rack power
              - entity: sensor.monitor_power
                name: Pi5 power
          - type: custom:vertical-stack-in-card
            cards:
              - type: grid
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.processor_use
                    primary_info: state
                    secondary_info: name
                    name: CPU
                    icon_color: red
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    entity: sensor.memory_use_percent
                    primary_info: state
                    secondary_info: name
                    name: Ram
                    icon_color: blue
                    layout: vertical
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.processor_use
                    name: CPU
                    color: var(--red-color)
                    y_axis: secondary
                  - entity: sensor.memory_use_percent
                    name: Ram
                    color: var(--blue-color)
                hours_to_show: 168
                points_per_hour: 1
                line_width: 4
                font_size: 50
                group_by: hour
                animate: true
                show:
                  name: false
                  icon: false
                  state: false
                  legend: false
                  fill: fade
          - type: tile
            entity: switch.monitor
            features_position: bottom
            vertical: true
            icon: mdi:cpu-64-bit
            state_content: last_changed
          - type: tile
            entity: switch.rackpower
            features_position: bottom
            vertical: true
            state_content: last_changed
            icon: mdi:server
            color: indigo
      - type: vertical-stack
        title: Charts
        cards:
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              title: Workstation
              show_states: true
              colorize_states: true
            graph_span: 168h
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.processor_use
                show:
                  extremas: true
                name: CPU
                type: line
                group_by:
                  func: avg
                  duration: 6h
              - entity: sensor.memory_use_percent
                show:
                  extremas: true
                name: RAM
                type: area
                group_by:
                  func: avg
                  duration: 6h
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              show_states: true
              colorize_states: true
            graph_span: 168h
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.disk_use_percent_config
                show:
                  extremas: true
                name: Disk Use
                type: area
                group_by:
                  func: avg
                  duration: 6h
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              show_states: true
              colorize_states: true
            graph_span: 168h
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.rack_temperature_2
                show:
                  extremas: true
                name: Rack
                type: line
                group_by:
                  func: avg
                  duration: 6h
              - entity: sensor.rack_temperature
                show:
                  extremas: true
                name: Floor 0l
                type: line
                group_by:
                  func: avg
                  duration: 6h
  - theme: Backend-selected
    title: Network
    path: network
    icon: mdi:lan
    badges: []
    cards:
      - type: vertical-stack
        title: Network
        cards:
          - square: false
            type: grid
            cards:
              - type: custom:mushroom-entity-card
                entity: binary_sensor.upnp_igd_wan_status
                name: Internet
                primary_info: state
                secondary_info: name
                fill_container: true
                icon_color: yellow
              - type: custom:mushroom-entity-card
                entity: sensor.upnp_igd_external_ip
                name: Ip
                primary_info: state
                secondary_info: name
                icon_color: green
            columns: 2
          - type: custom:uptime-card
            title_template: Internet
            entity: binary_sensor.upnp_igd_wan_status
            ok: 'on'
            ko: 'off'
            name: Internet
            hours_to_show: 168
            none: Unknown
            icon: mdi:web
            ko_icon: mdi:signal-off
            title_adaptive_color: true
            icon_adaptive_color: true
            status_adaptive_color: true
            bar:
              height: 15
              round: 90
              spacing: 2
              amount: 30
            init: {}
            color: {}
            severity: 100
            update_interval: 60
          - show_name: true
            show_icon: true
            show_state: true
            type: glance
            entities:
              - entity: device_tracker.floor00_deco
                name: Floor 00
                icon: mdi:router-wireless-settings
              - entity: device_tracker.floor01_deco
                name: Floor 01
                icon: mdi:router-wireless-settings
              - entity: device_tracker.floor02_deco_2
                name: Floor 02
                icon: mdi:router-wireless-settings
              - entity: device_tracker.nonna_deco
                name: Nonna
                icon: mdi:router-wireless-settings
              - entity: device_tracker.switchnorth_deco
                name: North
                icon: mdi:router-wireless
            state_color: true
          - show_name: true
            show_icon: true
            show_state: true
            type: glance
            entities:
              - entity: camera.entrance
                name: Entrance
                icon: mdi:cctv
              - entity: camera.back
                name: Back
                icon: mdi:cctv
              - entity: camera.garden
                name: Garden
                icon: mdi:cctv
              - entity: camera.garage
                name: Garage
                icon: mdi:cctv
            state_color: true
          - type: custom:vertical-stack-in-card
            title: Fiber Traffic
            cards:
              - type: grid
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.upnp_igd_upload_speed
                    primary_info: state
                    secondary_info: name
                    name: Up
                    icon_color: red
                  - type: custom:mushroom-entity-card
                    entity: sensor.upnp_igd_download_speed
                    primary_info: state
                    secondary_info: name
                    name: Down
                    icon_color: blue
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.upnp_igd_packet_upload_speed
                    name: Upload
                    color: var(--red-color)
                  - entity: sensor.upnp_igd_packet_download_speed
                    name: Download
                    color: var(--blue-color)
                hours_to_show: 72
                points_per_hour: 6
                line_width: 3
                font_size: 100
                group_by: hour
                cache: true
                animate: true
                show:
                  name: false
                  icon: false
                  extrema: true
                  state: false
                  legend: false
                  fill: fade
      - type: vertical-stack
        title: Internet Speed
        cards:
          - type: custom:vertical-stack-in-card
            title: LAN Traffic
            cards:
              - type: grid
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.total_down
                    primary_info: state
                    secondary_info: name
                    name: Deco Down
                    icon_color: red
                  - type: custom:mushroom-entity-card
                    entity: sensor.total_up
                    primary_info: state
                    secondary_info: name
                    name: Deco Up
                    icon_color: blue
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.total_down
                    name: Upload
                    color: var(--red-color)
                  - entity: sensor.total_up
                    name: Ping
                    color: var(--blue-color)
                    y_axis: secondary
                hours_to_show: 72
                points_per_hour: 6
                line_width: 3
                font_size: 100
                group_by: hour
                cache: true
                animate: true
                show:
                  name: false
                  icon: false
                  extrema: true
                  state: false
                  legend: false
                  fill: fade
          - type: custom:vertical-stack-in-card
            title: Deco
            cards:
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.nonna_down
                    name: Nonna
                    color: var(--red-color)
                  - entity: sensor.floor00_down
                    name: Floor 00
                    color: var(--orange-color)
                  - entity: sensor.floor01_down
                    name: Floor 01
                    color: var(--blue-color)
                  - entity: sensor.floor02_down_2
                    name: Floor 02
                    color: var(--green-color)
                  - entity: sensor.switchnorth_down
                    name: North
                    color: var(--yellow-color)
                hours_to_show: 72
                points_per_hour: 6
                line_width: 3
                font_size: 100
                group_by: hour
                height: 309
                animate: true
                show:
                  name: false
                  icon: false
                  extrema: true
                  state: false
                  legend: true
                  fill: fade
      - type: vertical-stack
        title: Devices
        cards:
          - type: custom:vertical-stack-in-card
            title: Speed Test
            cards:
              - type: grid
                square: false
                columns: 3
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.speedtest_download
                    primary_info: state
                    secondary_info: name
                    name: Download
                    icon_color: green
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    entity: sensor.speedtest_upload
                    primary_info: state
                    secondary_info: name
                    name: Upload
                    icon_color: blue
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    entity: sensor.speedtest_ping
                    primary_info: state
                    secondary_info: name
                    name: Ping
                    icon_color: yellow
                    layout: vertical
              - type: custom:mini-graph-card
                entities:
                  - entity: sensor.speedtest_download
                    name: Download
                    color: var(--green-color)
                  - entity: sensor.speedtest_upload
                    name: Upload
                    color: var(--blue-color)
                  - entity: sensor.speedtest_ping
                    name: Ping
                    color: var(--yellow-color)
                    y_axis: secondary
                hours_to_show: 72
                points_per_hour: 6
                line_width: 3
                font_size: 100
                animate: true
                show:
                  name: false
                  icon: false
                  extrema: true
                  state: false
                  legend: false
                  fill: fade
          - type: entity
            entity: sensor.network_scanner
            name: Network
            icon: mdi:access-point-network
            state_color: true
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /device_tracker.*(_[0-9]+)?/
            sort:
              method: state
              numeric: false
              reverse: false
              ip: false
            card:
              type: entities
              state_color: true
  - title: Shelly Tables
    path: shelly-tables
    icon: mdi:file-table-box-multiple-outline
    type: sidebar
    badges: []
    cards:
      - type: vertical-stack
        cards:
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*_rssi(_[0-9]+)?/
            sort:
              method: state
              numeric: true
              reverse: true
            card:
              type: custom:bar-card
              style: |-
                bar-card-value {
                  font-size: 15px;
                  font-weight: bold;
                  text-shadow: 1px 1px #0005;
                }
              min: -100
              max: -10
              positions:
                indicator: outside
                icon: false
                name: inside
              animation:
                state: 'true'
                speed: 3
              severity:
                - color: Red
                  from: -65
                - color: Orange
                  from: -65
                  to: -50
                - color: Blue
                  from: -50
                  to: -40
                - color: Green
                  from: -40
                  to: -10
                - hide: null
                  from: -5
                  to: 5
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*device_temperature(_[0-9]+)?/
              exclude:
                - entity_id: /sensor.SelvaHome*/
            sort:
              method: state
              reverse: true
              numeric: true
            show_empty: true
            card:
              type: custom:bar-card
              style: |-
                bar-card-value {
                  font-size: 15px;
                  font-weight: bold;
                  text-shadow: 1px 1px #0005;
                }
              positions:
                indicator: outside
                icon: false
                name: inside
              max: 60
              animation:
                state: 'true'
                speed: 3
              severity:
                - color: Red
                  from: 50
                - color: Orange
                  from: 40
                  to: 50
                - color: Blue
                  from: 30
                  to: 40
                - color: Green
                  from: 10
                  to: 30
                - hide: null
                  from: -5
                  to: 5
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*_power/
                  area: shelly
            sort:
              method: state
              numeric: true
              reverse: true
            card:
              type: custom:bar-card
              style: |-
                bar-card-value {
                  font-size: 15px;
                  font-weight: bold;
                  text-shadow: 1px 1px #0005;
                }
              positions:
                indicator: outside
                icon: false
                name: inside
              max: 1000
              animation:
                state: 'true'
                speed: 3
              severity:
                - color: Red
                  from: 1000
                - color: Orange
                  from: 600
                  to: 1000
                - color: Blue
                  from: 300
                  to: 600
                - color: Green
                  from: 10
                  to: 300
                - hide: null
                  from: -5
                  to: 5
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*_energy/
                  area: shelly
            sort:
              method: state
              numeric: true
              reverse: true
            card:
              type: entities
              state_color: true
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*_uptime/
                  area: shelly
            sort:
              method: state
              numeric: false
              reverse: true
            card:
              type: entities
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*_uptime/
                  area: shelly
            card:
              type: history-graph
              hours_to_show: 168
            sort:
              method: state
              reverse: true
              numeric: true
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*_cloud/
                  area: shelly
            sort:
              method: state
              numeric: true
              reverse: true
            card:
              type: entities
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*_cloud/
                  area: shelly
            card:
              type: history-graph
              hours_to_show: 168
            sort:
              method: last_changed
              reverse: true
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /sensor.*current(_[0-9]+)?/
              exclude:
                - entity_id: /sensor.SelvaHome*/
            sort:
              method: state
              reverse: true
              numeric: true
            show_empty: true
            card:
              type: custom:bar-card
              style: |-
                bar-card-value {
                  font-size: 15px;
                  font-weight: bold;
                  text-shadow: 1px 1px #0005;
                }
              positions:
                indicator: outside
                icon: false
                name: inside
              max: 60
              animation:
                state: 'true'
                speed: 3
              severity:
                - color: Red
                  from: 50
                - color: Orange
                  from: 40
                  to: 50
                - color: Blue
                  from: 30
                  to: 40
                - color: Green
                  from: 10
                  to: 30
                - hide: null
                  from: -5
                  to: 5
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /switch.reb*/
                  area: shelly
            sort:
              method: state
              numeric: true
              reverse: true
            card:
              type: entities
              state_color: true
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: /network.*(_[0-9]+)?/
              exclude:
                - entity_id: /sensor.SelvaHome*/
            sort:
              method: state
              reverse: true
              numeric: true
            show_empty: true
            card:
              type: custom:bar-card
              style: |-
                bar-card-value {
                  font-size: 15px;
                  font-weight: bold;
                  text-shadow: 1px 1px #0005;
                }
              positions:
                indicator: outside
                icon: false
                name: inside
              max: 60
              animation:
                state: 'true'
                speed: 3
              severity:
                - color: Red
                  from: 50
                - color: Orange
                  from: 40
                  to: 50
                - color: Blue
                  from: 30
                  to: 40
                - color: Green
                  from: 10
                  to: 30
                - hide: null
                  from: -5
                  to: 5
  - theme: Backend-selected
    title: Weather
    path: weather
    icon: mdi:weather-partly-cloudy
    badges:
      - type: entity
        show_name: true
        show_state: true
        show_icon: true
        color: ''
        entity: sensor.dpc_alert
        name: Allerta
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        color: ''
        entity: binary_sensor.dpc_idrogeologico_oggi
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        color: ''
        entity: binary_sensor.dpc_temporali_oggi
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        color: ''
        entity: weather.selvahome
    cards:
      - type: vertical-stack
        title: Previsioni
        cards:
          - type: iframe
            url: >-
              https://meteo.search.ch/widget/Camedo.it.html?bgcolor=dedede&amp;fgcolor=000000&amp;days=1
            aspect_ratio: '1'
          - type: custom:mushroom-entity-card
            entity: sensor.moon_phase
            layout: vertical
            primary_info: state
            secondary_info: name
            icon_color: light-grey
          - type: custom:sun-card
          - type: picture
            image: https://meteo.search.ch/images/meteosat.png
            tap_action:
              action: url
              url_path: >-
                https://www.meteoswiss.admin.ch/local-forecasts/camedo/6659.html#forecast-tab=detail-view
            hold_action:
              action: none
      - type: vertical-stack
        title: Attuale
        cards:
          - type: iframe
            url: https://swissmetnet-display.ch/otl/it
            aspect_ratio: 200%
            title: Meteo Swiss
            card-mod:
              style: |
                ha-card {
                 backgroud-color: black;
                }
  - title: Automations
    path: automations
    icon: mdi:file-tree
    badges: []
    cards:
      - type: vertical-stack
        title: Automations
        cards:
          - show_name: true
            show_icon: true
            type: button
            tap_action:
              action: navigate
              navigation_path: /config/automation/dashboard
            name: Automations
            icon: mdi:home-automation
            show_state: true
            icon_height: 35px
          - type: custom:auto-entities
            card:
              type: entities
              state_color: true
            filter:
              include:
                - entity_id: automation*
            sort:
              method: last_triggered
              reverse: true
      - type: custom:apexcharts-card
        experimental:
          color_threshold: true
        header:
          show: true
          title: Compare Day
          show_states: false
          colorize_states: true
        graph_span: 24h
        stacked: false
        apex_config:
          legend:
            show: false
        yaxis:
          - min: 0
            max: 5000
            decimals: 0
            apex_config:
              tickAmount: 5
        series:
          - entity: sensor.solarpoweravg
            name: Now
            type: line
            group_by:
              func: avg
              duration: 1day
          - entity: sensor.solarpoweravg
            offset: '-1d'
            name: 1 Day
            type: line
            group_by:
              func: avg
              duration: 1week
          - entity: sensor.solarpoweravg
            offset: '-2d'
            name: 2 Day
            type: line
            color: yellow
            group_by:
              func: avg
              duration: 1month
  - title: E
    path: e
    cards:
      - type: custom:plotly-graph
        raw_plotly_config: true
        hours_to_show: 6M
        refresh_interval: 5m
        title: Max Solar Power [W]
        layout:
          autosize: true
          height: 600
          margin:
            t: 0
            l: 55
            r: 45
            b: 65
          xaxis:
            title: Azimuth [°]
          yaxis:
            title: Elevation [°]
        entities:
          - entity: sensor.sun_solar_azimuth
            internal: true
            period: 5minute
            fn: |-
              $fn ({ xs, ys, vars }) => {
                vars.azimuth_raw_x_ = xs.map(x => x.getTime());
                vars.azimuth_raw_y_ = ys;
              }
          - entity: sensor.sun_solar_azimuth
            internal: true
            statistic: mean
            period: hour
            fn: |-
              $fn ({ xs, ys, vars }) => {
                const n = 6;
                const alphas = Array.from({ length: n }).map((_, i) => i / n);
                const interpolate = (arr) => (
                  arr.flatMap((v, i) => (
                    alphas.map((a) => (
                      v * (1 - a) + arr[i + 1] * a
                    ))
                  ))
                );
                const xs_ = xs.map(x => x.getTime());
                const i = xs_.findIndex(x => x > vars.azimuth_raw_x_[0]);
                vars.azimuth_raw_x = interpolate(xs_.slice(0, i));
                vars.azimuth_raw_y = interpolate(ys.slice(0, i));
              }
          - entity: sensor.sun_solar_elevation
            internal: true
            period: 5minute
            fn: |-
              $fn ({ xs, ys, vars }) => {
                vars.elevation_raw_x_ = xs.map(x => x.getTime());
                vars.elevation_raw_y_ = ys;
              }
          - entity: sensor.sun_solar_elevation
            internal: true
            statistic: mean
            period: hour
            fn: |-
              $fn ({ xs, ys, vars }) => {
                const n = 6;
                const alphas = Array.from({ length: n }).map((_, i) => i / n);
                const interpolate = (arr) => (
                  arr.flatMap((v, i) => (
                    alphas.map((a) => (
                      v * (1 - a) + arr[i + 1] * a
                    ))
                  ))
                );
                const xs_ = xs.map(x => x.getTime());
                const i = xs_.findIndex(x => x > vars.elevation_raw_x_[0]);
                vars.elevation_raw_x = interpolate(xs_.slice(0, i));
                vars.elevation_raw_y = interpolate(ys.slice(0, i));
              }
          - entity: sensor.solar_power
            internal: true
            period: 5minute
            fn: |-
              $fn ({ xs, ys, vars }) => {
                vars.power_raw_x_ = xs.map(x => x.getTime());
                vars.power_raw_y_ = ys;
              }
          - entity: sensor.solar_power
            internal: true
            statistic: mean
            period: hour
            fn: |-
              $fn ({ xs, ys, vars }) => {
                const n = 6;
                const alphas = Array.from({ length: n }).map((_, i) => i / n);
                const interpolate = (arr) => (
                  arr.flatMap((v, i) => (
                    alphas.map((a) => (
                      v * (1 - a) + arr[i + 1] * a
                    ))
                  ))
                );
                const xs_ = xs.map(x => x.getTime());
                const i = xs_.findIndex(x => x > vars.power_raw_x_[0]);
                vars.power_raw_x = interpolate(xs_.slice(0, i));
                vars.power_raw_y = interpolate(ys.slice(0, i));
              }
          - entity: ''
            type: heatmap
            hoverongaps: false
            colorscale: Rainbow
            fn: |-
              $fn ({ vars }) => {
                const x = Array.from({ length: 220 + 1 }, (e, i) => 70 + i);
                const y = Array.from({ length:  55 + 1 }, (e, i) =>  0 + i);
                const z = Array(y.length).fill(null).map(() => Array(x.length).fill(NaN));

                const setData = (powerX, powerY, azimuthX, azimuthY, elevationX, elevationY) => {
                  for (let i = 0; i < powerY.length; i++) {
                    const pw = powerY[i];
                    const ix = powerX[i];
                
                    const azi = azimuthX.indexOf(ix);
                    const eli = elevationX.indexOf(ix);
                
                    if (azi >= 0 && eli >= 0) {
                      const az = azimuthY[azi];
                      const el = elevationY[eli];
                
                      const pos_az_min = x.indexOf(Math.floor(az));
                      const pos_el_min = y.indexOf(Math.floor(el));
                      const pos_az_max = x.indexOf(Math.ceil(az));
                      const pos_el_max = y.indexOf(Math.ceil(el));
                
                      if (pos_az_min >= 0 && pos_el_min >= 0 && pos_az_max >= 0 && pos_el_max >= 0) {
                        for (let pos_az = pos_az_min; pos_az <= pos_az_max; pos_az++) {
                          for (let pos_el = pos_el_min; pos_el <= pos_el_max; pos_el++) {
                            if (isNaN(z[pos_el][pos_az])) {
                              z[pos_el][pos_az] = pw;
                            } else {
                              z[pos_el][pos_az] = Math.max(z[pos_el][pos_az], pw);
                            }
                          }
                        }
                      }
                    }
                  }
                };

                setData(vars.power_raw_x, vars.power_raw_y, vars.azimuth_raw_x, vars.azimuth_raw_y, vars.elevation_raw_x, vars.elevation_raw_y);
                setData(vars.power_raw_x_, vars.power_raw_y_, vars.azimuth_raw_x_, vars.azimuth_raw_y_, vars.elevation_raw_x_, vars.elevation_raw_y_);

                vars.x = x;
                vars.y = y;
                vars.z = z;
              }
            x: $fn ({ vars }) => vars.x
            'y': $fn ({ vars }) => vars.y
            z: $fn ({ vars }) => vars.z
    type: panel
  - title: Test
    path: test
    type: panel
    cards:
      - square: false
        type: grid
        cards:
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            header:
              show: true
              title: Compare Day
              show_states: false
              colorize_states: true
            graph_span: 24h
            stacked: false
            apex_config:
              legend:
                show: false
            yaxis:
              - min: 0
                max: 5000
                decimals: 0
                apex_config:
                  tickAmount: 5
            series:
              - entity: sensor.solarpoweravg
                name: Now
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-1d'
                name: 1 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-2d'
                name: 2 Day
                type: line
                color: yellow
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-3d'
                name: 3 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-4d'
                name: 4 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-5d'
                name: 5 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-6d'
                name: 6 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
              - entity: sensor.solarpoweravg
                offset: '-7d'
                name: 7 Day
                type: line
                group_by:
                  func: avg
                  duration: 10min
        columns: 1
      - title: History
        type: history-graph
        hours_to_show: 386
        entities:
          - sensor.20_pm2_da0_1_device_temperature
  - title: AC
    icon: mdi:air-conditioner
    badges: []
    cards:
      - type: vertical-stack
        title: Charts 12h
        cards:
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.acsala_power
                name: Sala
              - entity: sensor.acscala_power
                name: Scala
                color: green
            hours_to_show: 16
            points_per_hour: 80
            color_thresholds:
              - value: 300
                color: '#395ce6'
              - color: '#39e692'
              - color: '#cce639'
              - value: 1000
                color: '#ff0000'
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
          - type: custom:mini-graph-card
            entities:
              - entity: input_number.temp2previuous
                name: Mandata
              - entity: input_number.temp1previous
                name: Ritorno
            hours_to_show: 16
            points_per_hour: 12
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            show:
              name: true
              icon: false
              state: false
              legend: true
              fill: fade
              extrema: true
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.delta_temp
                name: Delta Temeprature
            hours_to_show: 16
            points_per_hour: 12
            color_thresholds:
              - value: 0
                color: '#395ce6'
              - color: '#39e692'
              - color: '#cce639'
              - value: 15
                color: '#ff0000'
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
      - type: vertical-stack
        title: Energy
        cards:
          - square: false
            type: grid
            cards:
              - type: statistic
                entity: sensor.acsala_energy
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Sala
              - type: statistic
                entity: sensor.acscala_energy
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Scala
              - type: statistic
                entity: sensor.ac_total_energy
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Total
            columns: 3
          - type: entities
            entities:
              - entity: sensor.acsala_energy_counter_week
                name: Weekly
              - entity: sensor.acsala_energy_counter_month
                name: Monthly
              - entity: sensor.acsala_energy_counter_quarter
                name: Quarter
              - entity: sensor.acsala_energy_counter_year
                name: Year
                secondary_info: none
            state_color: true
            title: AC Sala
          - chart_type: bar
            period: day
            type: statistics-graph
            entities:
              - entity: sensor.acsala_energy
                name: Sala
              - entity: sensor.acscala_energy
                name: Scala
            hide_legend: false
            days_to_show: 30
            title: AC Energy
            stat_types:
              - change
          - square: false
            title: Battery Energy
            type: grid
            cards:
              - type: statistic
                entity: sensor.battery_out_energy_integral
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                icon: mdi:battery-negative
              - type: statistic
                entity: sensor.battery_out_energy_integral
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:battery-negative
              - type: statistic
                entity: sensor.battery_out_energy_integral
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:battery-negative
              - type: statistic
                entity: sensor.battery_in_energy_integral
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                icon: mdi:battery-positive
              - type: statistic
                entity: sensor.battery_in_energy_integral
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:battery-positive
              - type: statistic
                entity: sensor.battery_in_energy_integral
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:battery-positive
              - type: statistic
                entity: sensor.battery_net_energy_integral
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                icon: mdi:battery
              - type: statistic
                entity: sensor.battery_net_energy_integral
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:battery
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:battery
                entity: sensor.battery_net_energy_integral
            columns: 3
          - chart_type: bar
            period: day
            type: statistics-graph
            entities:
              - sensor.battery_net_energy_integral
            hide_legend: true
            days_to_show: 30
            stat_types:
              - change
            title: Battery Net
      - type: vertical-stack
        title: Charts 24h
        cards:
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.acsala_current
                name: Current
              - entity: sensor.acscala_current
                name: Scala
                color: green
            hours_to_show: 24
            points_per_hour: 12
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            color_thresholds:
              - value: 1
                color: '#395ce6'
              - color: '#cce639'
              - value: 5
                color: '#ff0000'
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.acsala_voltage
                name: Voltage
              - entity: sensor.acscala_voltage
                name: Scala
            hours_to_show: 24
            points_per_hour: 12
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.acsala_device_temperature
                name: Device Temp
              - entity: sensor.acscala_device_temperature
                name: Scala
            hours_to_show: 24
            points_per_hour: 12
            line_width: 3
            font_size: 100
            animate: true
            cache: true
            show:
              name: true
              icon: false
              state: false
              legend: false
              fill: fade
              extrema: true
    type: sections
    sections:
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: vertical-stack
            title: Status
            cards:
              - type: thermostat
                entity: climate.ac_sala_wifi
                features:
                  - type: climate-fan-modes
                    style: dropdown
                  - type: climate-preset-modes
                    style: dropdown
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.ac_sala_wifi_high_power_mode
                    icon_color: red
                    layout: horizontal
                    name: HP
                    icon: mdi:power-socket
                columns: 1
              - type: custom:bar-card
                title: Power
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1000
                  - color: Red
                    from: 1000
                    to: 2000
                  - color: Green
                    from: 0
                    to: 650
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.acsala_power
                    name: Sala
                    max: '1800'
                    icon: mdi:air-conditioner
                  - entity: sensor.acscala_power
                    name: Scala
                    max: '1800'
                    icon: mdi:air-conditioner
                  - entity: sensor.battery_net_power
                    name: Battery
                    min: '-1000'
                    max: '1500'
                    icon: mdi:battery
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-template-card
                    primary: switch A
                    secondary: >-
                      {{is_state('switch.sw1', "on")  | iif("Batteria", "Enel")
                      }}
                    icon: >
                      {{ is_state('switch.sw1', "on")  |
                      iif("mdi:electric-switch-closed", "mdi:electric-switch")
                      }}
                    icon_color: |
                      {{ is_state('switch.sw1', "on") | iif("blue", "yellow") }}
                    entity: switch.sw1
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: ''
                    fill_container: true
                    badge_color: ''
                  - type: custom:mushroom-template-card
                    primary: switch B
                    secondary: >-
                      {{is_state('switch.sw2', "on")  | iif("Batteria", "Enel")
                      }}
                    icon: >
                      {{ is_state('switch.sw2', "on") |
                      iif("mdi:electric-switch-closed", "mdi:electric-switch")
                      }}
                    icon_color: |
                      {{ is_state('switch.sw2', "on") | iif("blue", "yellow") }}
                    entity: switch.sw2
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: ''
                    fill_container: true
                    badge_color: ''
                  - type: custom:mushroom-template-card
                    primary: '{{states.sensor.acsala_power.state}} W'
                    secondary: 'AC Sala: {{states.switch.acsala.state | upper}}'
                    icon: mdi:air-conditioner
                    icon_color: >
                      {{ (states("sensor.acsala_power")|float(0) > 10) |
                      iif("green", "red") }}
                    entity: switch.acsala
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: >-
                      {{is_state('switch.sw1', "on")  | iif("mdi:battery-plus",
                      "mdi:transmission-tower-import") }}
                    fill_container: true
                    double_tap_action:
                      action: toggle
                    badge_color: '{{is_state(''switch.sw1'', "on")  | iif("blue", "yellow") }}'
                  - type: custom:mushroom-template-card
                    primary: '{{states.sensor.acscala_power.state}} W'
                    secondary: 'AC Scala: {{states.switch.acscala.state | upper}}'
                    icon: mdi:air-conditioner
                    icon_color: >
                      {{ (states("sensor.acscala_power")|float(0) > 10) |
                      iif("green", "red") }}
                    entity: switch.acscala
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: >-
                      {{is_state('switch.sw2', "on")  | iif("mdi:battery-plus",
                      "mdi:transmission-tower-import") }}
                    fill_container: true
                    double_tap_action:
                      action: toggle
                    badge_color: '{{is_state(''switch.sw2'', "on")  | iif("blue", "yellow") }}'
                  - type: custom:mushroom-template-card
                    primary: '{{states.sensor.ininverter_power.state}} W'
                    secondary: IN Inverter
                    icon: mdi:current-ac
                    icon_color: >
                      {{ (states("sensor.ininverter_power")|float(0) > 0) |
                      iif("green", "") }}
                    entity: switch.ininverter
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: ''
                    fill_container: false
                    layout: vertical
                    badge_color: ''
                  - type: custom:mushroom-template-card
                    primary: '{{states.sensor.battery_out_power.state}} W'
                    secondary: OUT Inverter
                    icon: mdi:generator-mobile
                    icon_color: >
                      {{ (states("sensor.battery_out_power")|float(0) > 0) |
                      iif("purple", "") }}
                    entity: sensor.battery_out_power
                    multiline_secondary: true
                    tap_action:
                      action: more-info
                    badge_icon: ''
                    fill_container: true
                    layout: vertical
                    badge_color: ''
                columns: 2
              - type: history-graph
                entities:
                  - entity: switch.ininverter
                    name: Battery In
                  - entity: switch.sw1
                    name: A
                  - entity: switch.sw2
                    name: B
                  - entity: binary_sensor.ac_sala_function
                    name: Sala
                  - entity: switch.ac_sala_wifi_high_power_mode
                    name: HiPower
                  - entity: switch.fan
                    name: Bagno
                hours_to_show: 16
              - square: false
                title: Temperature
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    name: Home
                    icon_color: purple
                    entity: sensor.home_temperature
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: green
                    entity: input_number.temp_out_saved
                    name: Out
                    icon: mdi:temperature-celsius
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: red
                    icon: ''
                    entity: input_number.temp2previuous
                    name: Mandata
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: light-blue
                    entity: input_number.temp1previous
                    icon: ''
                    name: Ritorno
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: lime
                    icon: mdi:delta
                    entity: sensor.delta_temp
                    name: Delta
                  - type: custom:mushroom-entity-card
                    primary_info: state
                    secondary_info: name
                    icon_color: white
                    icon: mdi:current-ac
                    entity: sensor.acsala_voltage
                    name: Voltage
                columns: 2
  - title: E
    cards: []
    type: sections
    sections:
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#kitchen'
                name: Kitchen
                icon: mdi:fridge
                entity: switch.0c0_empty
                card_layout: large
          - type: custom:bubble-card
            card_type: button
            button_type: state
            card_layout: large-2-rows
            name: Energy
            entity: sensor.current_power_production
            icon: mdi:home-lightning-bolt-outline
            show_state: true
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#energy'
            sub_button:
              - entity: sensor.solarman_daily_battery_charge
                icon: mdi:counter
                show_background: false
                show_state: true
                tap_action:
                  action: more-info
              - entity: sensor.today_s_energy_production
                show_state: true
                show_background: false
              - entity: sensor.average_daily_consumption
                show_background: false
                show_state: true
              - entity: sensor.this_week_production
                show_state: true
                show_background: false
                icon: mdi:calendar-week
  - type: masonry
    path: ''
    cards:
      - type: custom:bubble-card
        card_type: button
        button_type: name
        name: Ac
        icon: mdi:air-conditioner
        button_action:
          tap_action:
            action: navigate
            navigation_path: '#ac-sala'
        sub_button:
          - entity: sensor.ac_total_power
            show_state: true
            show_attribute: false
            visibility:
              - condition: numeric_state
                entity: sensor.ac_total_power
                above: 50
      - type: custom:bubble-card
        card_type: button
        button_type: switch
        name: Boiler
        icon: mdi:water-boiler
        button_action:
          tap_action:
            action: navigate
            navigation_path: '#boiler'
        sub_button:
          - show_state: true
            show_attribute: false
            visibility:
              - condition: numeric_state
                entity: sensor.ac_total_power
                above: 50
            entity: sensor.boiler_status
          - entity: sensor.boiler_power
            show_name: false
            show_state: true
        entity: sensor.acsala_current
        card_layout: large-2-rows
      - type: custom:bubble-card
        card_type: button
        button_type: name
        name: Lavastoviglie
        icon: mdi:dishwasher
        button_action:
          tap_action:
            action: navigate
            navigation_path: '#lavastoviglie'
        sub_button:
          - show_state: true
            show_attribute: false
            visibility:
              - condition: numeric_state
                entity: sensor.ac_total_power
                above: 50
            entity: sensor.dishwasher_operation_state
          - entity: sensor.washdisher_power
            show_name: false
            show_state: true
      - type: custom:bubble-card
        card_type: button
        button_type: name
        name: Lavatrice
        icon: mdi:washing-machine
        button_action:
          tap_action:
            action: navigate
            navigation_path: '#lavatrice'
        sub_button:
          - show_state: true
            show_attribute: false
            visibility: []
            entity: sensor.front_load_washer_current_course
            name: Prog
            show_name: true
            icon: mdi:progress-check
          - entity: sensor.washmachine_power
            show_name: false
            show_state: true
            visibility:
              - condition: numeric_state
                entity: switch.washmachine
                above: 20
      - type: custom:bubble-card
        card_type: button
        button_type: name
        name: Kitchen
        icon: mdi:fridge
        button_action:
          tap_action:
            action: navigate
            navigation_path: '#kitchen'
      - type: custom:bubble-card
        card_type: button
        entity: weather.selvahome
        tap_action:
          action: navigate
          navigation_path: '#meteo'
        button_type: state
        name: Meteo
        sub_button:
          - entity: input_number.temp_out_saved
            show_state: true
            show_icon: true
            icon: mdi:temperature-celsius
        card_layout: large
        button_action:
          tap_action:
            action: none
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#ac-sala'
            name: AC Sala
            icon: mdi:air-conditioner
            card_layout: large
            button_type: state
            entity: binary_sensor.ac_sala_function
            show_attribute: false
            tap_action:
              action: none
            show_last_changed: true
            columns: 4
            rows: 4
            width_desktop: 860px
            bg_opacity: '80'
            bg_blur: '15'
            margin: 2px
          - type: custom:bubble-card
            card_type: climate
            entity: climate.ac_sala_wifi
            sub_button:
              - name: HVAC modes menu
                select_attribute: hvac_modes
                state_background: false
                show_arrow: false
              - entity: climate.ac_sala_wifi
                select_attribute: preset_modes
                name: 'Presets '
            show_attribute: false
            attribute: preset_modes
            card_layout: large
            name: Sala
            icon: mdi:air-conditioner
            state_color: true
          - type: custom:bubble-card
            card_type: button
            button_type: state
            tap_action:
              action: navigate
              navigation_path: '#kitchen'
            entity: switch.ac_sala_wifi_high_power_mode
            sub_button: []
            button_action:
              double_tap_action:
                action: toggle
            name: Hi Power
            icon: mdi:fire-circle
            show_attribute: false
            show_last_changed: true
          - type: custom:bar-card
            style: |-
              bar-card-value {
                margin-right: auto;
                font-size: 20px;
                font-weight: bold;
                text-shadow: 1px 1px #0005;
              }
            positions:
              indicator: outside
              name: inside
            animation:
              state: 'true'
              speed: 3
            severity:
              - color: Orange
                from: 650
                to: 1200
              - color: Red
                from: 1200
                to: 2000
              - color: Green
                from: 0
                to: 850
              - hide: null
                from: -5
                to: 5
            entities:
              - entity: sensor.acsala_power
                name: Sala
                max: '1800'
                icon: mdi:air-conditioner
          - type: history-graph
            entities:
              - entity: binary_sensor.ac_sala_function
                name: 'On'
              - entity: switch.ac_sala_wifi_high_power_mode
                name: Hi
          - type: custom:plotly-graph
            entities:
              - entity: sensor.acsala_power
            logarithmic_scale: false
            hours_to_show: 16
            refresh_interval: 10
            autorange_after_scroll: true
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 3
                      step: hour
                    - count: 16
                      step: hour
                    - count: 36
                      step: hour
                    - count: 5
                      step: day
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                icon: mdi:battery-negative
                entity: sensor.acsala_energy
              - type: statistic
                period:
                  calendar:
                    period: week
                stat_type: change
                icon: mdi:battery-negative
                entity: sensor.acsala_energy
                name: Week
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                icon: mdi:battery-negative
                entity: sensor.acsala_energy
                name: Month
            columns: 3
          - type: custom:plotly-graph
            hours_to_show: 31d
            title: Energy
            refresh_interval: auto
            entities:
              - entity: sensor.acsala_energy
                name: Daily
                unit_of_measurement: kWh
                type: bar
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - map_y: parseFloat(y.toFixed(2))
                marker:
                  color: |-
                    $ex ys.map(y => {
                      let value = y;
                      return value > 14 ? "darkred" : 
                             value > 12 ? "red" : 
                             value > 10? "darkorange" : 
                             value > 5 ? "orange" : 
                             value > 0 ? "blue" : "green";
                    })
              - entity: sensor.acsala_energy
                name: Avg
                unit_of_measurement: kWh
                type: line
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - sliding_window_moving_average: 7
                  - map_y: parseFloat(y.toFixed(2))
                line:
                  color: yellow
                  width: 2
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 7
                      step: day
                    - count: 30
                      step: day
                    - count: 90
                      step: day
                    - count: 6
                      step: month
                    - count: 1
                      step: year
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#boiler'
            name: Boiler
            icon: mdi:water-boiler
            card_layout: large
            button_type: state
            entity: sensor.boiler_status
            show_attribute: false
            tap_action:
              action: none
            show_last_changed: true
            columns: 4
            rows: 4
            width_desktop: 860px
            bg_opacity: '80'
            bg_blur: '15'
            margin: 2px
          - type: custom:bubble-card
            card_type: button
            button_type: state
            tap_action:
              action: navigate
              navigation_path: '#kitchen'
            sub_button: []
            button_action:
              double_tap_action:
                action: toggle
            name: Power
            icon: mdi:power
            show_attribute: false
            show_last_changed: true
            entity: switch.boiler
          - type: custom:bubble-card
            card_type: button
            button_type: state
            entity: sensor.boiler_total_on_duration
            sub_button:
              - entity: sensor.boiler_heat_pump_duration
                name: P
                show_name: true
                show_state: true
                icon: mdi:pump
              - entity: sensor.boiler_pump_resistance_duration
                show_state: true
                show_name: true
                name: P & R
                icon: mdi:air-filter
              - entity: sensor.boiler_resistance_duration
                show_state: true
                show_name: true
                name: R
                icon: mdi:resistor
            name: Duration
          - type: custom:bar-card
            style: |-
              bar-card-value {
                margin-right: auto;
                font-size: 20px;
                font-weight: bold;
                text-shadow: 1px 1px #0005;
              }
            positions:
              indicator: outside
              name: inside
            animation:
              state: 'true'
              speed: 3
            severity:
              - color: Orange
                from: 650
                to: 1200
              - color: Red
                from: 1200
                to: 2000
              - color: Green
                from: 0
                to: 850
              - hide: null
                from: -5
                to: 5
            entities:
              - entity: sensor.boiler_power
                name: Boiler
                max: '1800'
                icon: mdi:water-boiler
          - type: history-graph
            entities:
              - entity: switch.boiler
                name: 'On'
              - entity: sensor.boiler_status
                name: Status
          - type: custom:plotly-graph
            entities:
              - entity: sensor.boiler_power
            logarithmic_scale: false
            hours_to_show: 16
            refresh_interval: 10
            autorange_after_scroll: true
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 3
                      step: hour
                    - count: 16
                      step: hour
                    - count: 36
                      step: hour
                    - count: 5
                      step: day
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                entity: sensor.boiler_energy
                icon: mdi:view-day-outline
              - type: statistic
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:calendar-week
                entity: sensor.boiler_energy
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:calendar-month
                entity: sensor.boiler_energy
            columns: 3
          - type: custom:plotly-graph
            hours_to_show: 31d
            title: Energy
            refresh_interval: auto
            entities:
              - entity: sensor.boiler_energy
                name: Daily
                unit_of_measurement: kWh
                type: bar
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - map_y: parseFloat(y.toFixed(2))
                marker:
                  color: |-
                    $ex ys.map(y => {
                      let value = y;
                      return value > 4 ? "darkred" : 
                             value > 3? "red" : 
                             value > 2 ? "darkorange" : 
                             value > 6 ? "orange" : 
                             value > 0 ? "blue" : "green";
                    })
              - entity: sensor.boiler_energy
                name: Avg
                unit_of_measurement: kWh
                type: line
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - sliding_window_moving_average: 7
                  - map_y: parseFloat(y.toFixed(2))
                line:
                  color: yellow
                  width: 2
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 7
                      step: day
                    - count: 30
                      step: day
                    - count: 90
                      step: day
                    - count: 6
                      step: month
                    - count: 1
                      step: year
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#lavastoviglie'
            name: Lavastoviglie
            icon: mdi:dishwasher
            card_layout: large
            button_type: state
            entity: sensor.dishwasher_operation_state
            show_attribute: false
            tap_action:
              action: none
            show_last_changed: true
            columns: 4
            rows: 4
            width_desktop: 860px
            bg_opacity: '80'
            bg_blur: '15'
            margin: 2px
          - type: custom:bubble-card
            card_type: button
            button_type: state
            tap_action:
              action: navigate
              navigation_path: '#kitchen'
            sub_button: []
            button_action:
              double_tap_action:
                action: toggle
            name: Power
            icon: mdi:power
            show_attribute: false
            show_last_changed: true
            entity: switch.dishwasher_power
          - type: custom:bubble-card
            card_type: button
            button_type: state
            entity: select.dishwasher_active_program
            sub_button:
              - entity: switch.dishwasher_program_auto2
                name: Auto
                show_name: true
                show_state: true
                icon: mdi:magic-staff
              - entity: switch.dishwasher_program_prerinse
                show_state: true
                show_name: true
                name: Rinse
                icon: mdi:liquid-spot
            name: Programma
          - type: custom:bar-card
            style: |-
              bar-card-value {
                margin-right: auto;
                font-size: 20px;
                font-weight: bold;
                text-shadow: 1px 1px #0005;
              }
            positions:
              indicator: outside
              name: inside
            animation:
              state: 'true'
              speed: 3
            severity:
              - color: Orange
                from: 650
                to: 1200
              - color: Red
                from: 1200
                to: 2000
              - color: Green
                from: 0
                to: 850
              - hide: null
                from: -5
                to: 5
            entities:
              - entity: sensor.washdisher_power
                name: Lavastoviglie
                max: '1800'
                icon: mdi:dishwasher
          - type: history-graph
            entities:
              - entity: switch.dishwasher_power
                name: 'On'
              - entity: select.dishwasher_active_program
                name: Status
          - type: custom:plotly-graph
            entities:
              - entity: sensor.washdisher_power
            logarithmic_scale: false
            hours_to_show: 16
            refresh_interval: 10
            autorange_after_scroll: true
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 3
                      step: hour
                    - count: 16
                      step: hour
                    - count: 36
                      step: hour
                    - count: 5
                      step: day
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                entity: sensor.lavastoviglie_energy
                icon: mdi:view-day-outline
              - type: statistic
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:calendar-week
                entity: sensor.lavastoviglie_energy
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:calendar-month
                entity: sensor.lavastoviglie_energy
            columns: 3
          - type: custom:plotly-graph
            hours_to_show: 31d
            title: Energy
            refresh_interval: auto
            entities:
              - entity: sensor.lavastoviglie_energy
                name: Daily
                unit_of_measurement: kWh
                type: bar
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - map_y: parseFloat(y.toFixed(2))
                marker:
                  color: |-
                    $ex ys.map(y => {
                      let value = y;
                      return value > 3 ? "darkred" : 
                             value > 2? "red" : 
                             value > 1 ? "darkorange" : 
                             value > 0 ? "blue" : "green";
                    })
              - entity: sensor.lavastoviglie_energy
                name: Avg
                unit_of_measurement: kWh
                type: line
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - sliding_window_moving_average: 7
                  - map_y: parseFloat(y.toFixed(2))
                line:
                  color: yellow
                  width: 2
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 7
                      step: day
                    - count: 30
                      step: day
                    - count: 90
                      step: day
                    - count: 6
                      step: month
                    - count: 1
                      step: year
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#lavatrice'
            name: Lavatrice
            icon: mdi:washing-machine
            card_layout: large
            button_type: state
            entity: sensor.front_load_washer_current_course
            show_attribute: false
            tap_action:
              action: none
            show_last_changed: true
            columns: 4
            rows: 4
            width_desktop: 860px
            bg_opacity: '80'
            bg_blur: '15'
            margin: 2px
          - type: custom:bubble-card
            card_type: button
            button_type: state
            tap_action:
              action: navigate
              navigation_path: '#kitchen'
            sub_button: []
            button_action:
              double_tap_action:
                action: toggle
            name: Power
            icon: mdi:power
            show_attribute: false
            show_last_changed: true
            entity: switch.washmachine
          - type: custom:bubble-card
            card_type: button
            button_type: state
            entity: sensor.front_load_washer_current_course
            sub_button:
              - entity: sensor.front_load_washer_remaining_time
                name: Remain
                show_name: true
                show_state: true
                icon: mdi:magic-staff
              - entity: sensor.front_load_washer_spin_speed
                show_state: true
                show_name: true
                name: Speed
                icon: mdi:speedometer
            name: Programma
          - type: custom:bubble-card
            card_type: select
            entity: select.washer_course_selection
          - type: custom:bar-card
            style: |-
              bar-card-value {
                margin-right: auto;
                font-size: 20px;
                font-weight: bold;
                text-shadow: 1px 1px #0005;
              }
            positions:
              indicator: outside
              name: inside
            animation:
              state: 'true'
              speed: 3
            severity:
              - color: Orange
                from: 650
                to: 1200
              - color: Red
                from: 1200
                to: 2000
              - color: Green
                from: 0
                to: 850
              - hide: null
                from: -5
                to: 5
            entities:
              - entity: sensor.washmachine_power
                name: Lavatrice
                max: '1800'
                icon: mdi:washing-machine
          - type: history-graph
            entities:
              - entity: sensor.front_load_washer
                name: 'On'
              - entity: sensor.front_load_washer_current_course
                name: Status
              - entity: binary_sensor.dishwasher_door
                name: Door
            hours_to_show: 16
          - type: custom:plotly-graph
            entities:
              - entity: sensor.washmachine_power
            logarithmic_scale: false
            hours_to_show: 16
            refresh_interval: 10
            autorange_after_scroll: true
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 3
                      step: hour
                    - count: 16
                      step: hour
                    - count: 36
                      step: hour
                    - count: 5
                      step: day
          - square: false
            type: grid
            cards:
              - type: statistic
                period:
                  calendar:
                    period: day
                stat_type: change
                name: Day
                entity: sensor.washmachine_energy
                icon: mdi:view-day-outline
              - type: statistic
                period:
                  calendar:
                    period: week
                stat_type: change
                name: Week
                icon: mdi:calendar-week
                entity: sensor.washmachine_energy
              - type: statistic
                period:
                  calendar:
                    period: month
                stat_type: change
                name: Month
                icon: mdi:calendar-month
                entity: sensor.washmachine_energy
            columns: 3
          - type: custom:plotly-graph
            hours_to_show: 31d
            title: Energy
            refresh_interval: auto
            entities:
              - entity: sensor.washmachine_energy
                name: Daily
                unit_of_measurement: kWh
                type: bar
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - map_y: parseFloat(y.toFixed(2))
                marker:
                  color: |-
                    $ex ys.map(y => {
                      let value = y;
                      return value > 3 ? "darkred" : 
                             value > 2? "red" : 
                             value > 1 ? "darkorange" : 
                             value > 0 ? "blue" : "green";
                    })
              - entity: sensor.washmachine_energy
                name: Avg
                unit_of_measurement: kWh
                type: line
                statistic: state
                period: day
                filters:
                  - resample: 1d
                  - delta
                  - sliding_window_moving_average: 7
                  - map_y: parseFloat(y.toFixed(2))
                line:
                  color: yellow
                  width: 2
            layout:
              height: 500
              xaxis:
                rangeselector:
                  'y': 1.2
                  buttons:
                    - count: 7
                      step: day
                    - count: 30
                      step: day
                    - count: 90
                      step: day
                    - count: 6
                      step: month
                    - count: 1
                      step: year
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#weather'
            name: Weather
            icon: mdi:weather-cloudy-clock
            card_layout: large
            button_type: state
            entity: weather.selvahome
            show_attribute: false
            tap_action:
              action: none
            show_last_changed: true
            columns: 4
            rows: 4
            width_desktop: 860px
            bg_opacity: '80'
            bg_blur: '15'
            margin: 2px
          - type: vertical-stack
            cards:
              - type: vertical-stack
                title: Previsioni
                cards:
                  - type: iframe
                    url: >-
                      https://meteo.search.ch/widget/Camedo.it.html?bgcolor=dedede&amp;fgcolor=000000&amp;days=1
                    aspect_ratio: '1'
                  - type: custom:mushroom-entity-card
                    entity: sensor.moon_phase
                    layout: vertical
                    primary_info: state
                    secondary_info: name
                    icon_color: light-grey
                  - type: custom:sun-card
                  - type: picture
                    image: https://meteo.search.ch/images/meteosat.png
                    tap_action:
                      action: url
                      url_path: >-
                        https://www.meteoswiss.admin.ch/local-forecasts/camedo/6659.html#forecast-tab=detail-view
                    hold_action:
                      action: none
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.temperatureout
                title: Out
                logarithmic_scale: false
                hours_to_show: 72
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 600
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 16
                          step: hour
                        - count: 48
                          step: hour
                        - count: 7
                          step: day
                        - count: 30
                          step: day
      - chart_type: bar
        period: hour
        type: statistics-graph
        entities:
          - sensor.acsala_energy
        stat_types:
          - change
        days_to_show: 2
  - type: sections
    max_columns: 4
    title: Aaa
    path: aaa
    sections:
      - type: grid
        cards:
          - type: heading
            heading_style: title
            heading: 'Cucina '
            icon: mdi:countertop
            badges:
              - type: entity
                entity: sensor.kitchen_power
              - type: entity
                entity: sensor.cucina_temp_temperature
              - type: entity
                entity: sensor.cucina_temp_humidity
          - type: custom:bubble-card
            card_type: button
            button_type: name
            name: Ac
            icon: mdi:air-conditioner
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#kitchen'
            sub_button:
              - entity: sensor.ac_total_power
                show_state: true
                show_attribute: false
                visibility:
                  - condition: numeric_state
                    entity: sensor.ac_total_power
                    above: 50
            grid_options:
              columns: 3
              rows: 2
          - type: custom:bubble-card
            card_type: button
            button_type: name
            name: Ac
            icon: mdi:air-conditioner
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#kitchen'
            sub_button:
              - entity: sensor.ac_total_power
                show_state: true
                show_attribute: false
                visibility:
                  - condition: numeric_state
                    entity: sensor.ac_total_power
                    above: 50
            grid_options:
              columns: 9
              rows: 2
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#kitchen'
                name: Kitchen
                icon: mdi:fridge
                entity: switch.0c0_empty
                card_layout: large
              - type: custom:bubble-card
                card_type: climate
                entity: climate.ac_sala_wifi
                sub_button:
                  - name: HVAC modes menu
                    select_attribute: hvac_modes
                    state_background: false
                    show_arrow: false
                  - entity: climate.ac_sala_wifi
                    select_attribute: preset_modes
                    name: 'Presets '
                show_attribute: false
                attribute: preset_modes
                card_layout: large
                name: Sala
                icon: mdi:air-conditioner
                state_color: true
              - type: custom:bar-card
                entities:
                  - entity: sensor.acsala_power
              - type: custom:bubble-card
                card_type: button
                button_type: switch
                entity: switch.sw1
                name: ''
                sub_button:
                  - entity: switch.sw1
                  - entity: switch.sw2
                  - entity: sensor.acsala_power
                  - entity: switch.sw1
              - type: custom:bubble-card
                card_type: button
                button_type: state
                card_layout: large-2-rows
                name: Battery
                icon: mdi:battery-70
                show_state: true
                button_action:
                  tap_action:
                    action: navigate
                    navigation_path: '#energy'
                sub_button:
                  - entity: sensor.solarman_daily_battery_charge
                    icon: mdi:counter
                    show_background: false
                    show_state: true
                    tap_action:
                      action: more-info
                  - entity: sensor.solarman_daily_battery_discharge
                    show_state: true
                    show_background: false
                  - show_background: false
                    show_state: true
                    entity: sensor.solarman_total_battery_charge
                  - show_state: true
                    show_background: false
                    icon: mdi:calendar-week
                    entity: sensor.solarman_total_battery_discharge
                entity: sensor.solarman_battery_voltage
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.acsala_power
                hours_to_show: 24
                refresh_interval: 10
              - chart_type: bar
                period: day
                type: statistics-graph
                entities:
                  - sensor.acsala_energy
                stat_types:
                  - change
                hide_legend: true
                days_to_show: 31
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.solarman_battery_voltage
                hours_to_show: 24
                refresh_interval: 10
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.sala_2
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.boiler_current
                tap_action:
                  action: navigate
                  navigation_path: '#kitchen'
              - square: false
                type: grid
                cards:
                  - type: entities
                    entities:
                      - entity: input_number.kwh_to_turn_on_switch
                        name: Soglia produzione ON
                      - entity: input_number.battery_cut_off
                        name: Tensione OFF
                      - entity: input_number.autoconsumo_cut_off
                        name: Autoconsumo OFF
                      - entity: sensor.battery_self_used_percent
                        name: Consumato
                    title: Battery Setting
                    state_color: true
                  - type: entities
                    entities:
                      - entity: automation.accendi_se_caricato_x
                        secondary_info: last-triggered
                        name: Produzione Soglia ON
                        icon: mdi:solar-power-variant
                      - entity: automation.battery_off_at_soc_level
                        name: Battery OFF  a Tensione OFF
                        secondary_info: last-triggered
                        icon: mdi:battery-10
                      - entity: automation.battery_autoconsumo
                        secondary_info: last-triggered
                        name: Autonconsumo OFF
                        icon: mdi:home-battery-outline
                      - entity: sensor.solarman_status_lastupdate
                        name: Update
                        secondary_info: last-changed
                  - type: history-graph
                    entities:
                      - entity: switch.sw1
                      - entity: switch.sw2
                    hours_to_show: 12
                  - type: gauge
                    entity: sensor.solarman_battery_voltage
                    name: Battery V
                    needle: true
                    severity:
                      green: 46
                      yellow: 48
                      red: 51
                    min: 46
                    max: 57
                    unit: V
                    view_layout:
                      position: sidebar
                  - square: false
                    type: grid
                    cards:
                      - type: statistic
                        period:
                          calendar:
                            period: day
                        stat_type: min
                        entity: sensor.solarman_battery_voltage
                        name: Min
                        unit: V
                        icon: mdi:battery-40
                        view_layout:
                          position: sidebar
                      - type: statistic
                        period:
                          calendar:
                            period: day
                        stat_type: max
                        entity: sensor.solarman_battery_voltage
                        name: Max
                        unit: V
                        view_layout:
                          position: sidebar
                    columns: 2
                    view_layout:
                      position: sidebar
                columns: 1
                view_layout:
                  position: sidebar
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#inverter-garage'
                button_type: name
                name: Inverter Garage
                icon: mdi:garage-open-variant
                width_desktop: 860px
                margin: 0px
              - type: custom:bubble-card
                card_type: separator
              - type: custom:mushroom-entity-card
                entity: switch.casa_nonna
                name: Casa Nonna
                icon: mdi:electric-switch
                icon_color: deep-orange
              - square: false
                type: grid
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.shellyswitch25_c82b96116215_channel_1
                    name: Stufa Bassa
                    icon: mdi:electric-switch
                    icon_color: yellow
                  - type: custom:mushroom-entity-card
                    entity: switch.shellyswitch25_c82b96116215_channel_2
                    name: Stufa Alta
                    icon: mdi:electric-switch
                    icon_color: blue
              - type: custom:bar-card
                entities:
                  - entity: sensor.casa_nonna_power
                    name: Power
              - type: gauge
                entity: sensor.batterie_garage_voltmeter
                name: Batterie
                unit: V
                min: 20
                max: 28
                needle: true
                severity:
                  green: 0
                  yellow: 23
                  red: 25
              - type: entities
                entities:
                  - entity: input_number.garage_battery_tensione_cut_off
                    name: Tensione OFF
                  - entity: automation.casa_nonna_tensione_off
                    name: Spegni a Tensione OFF
                  - entity: input_number.casa_nonna_power_on
                    name: Soglia Solar
                  - entity: automation.casa_nonna_solar_off
                    name: OFF Solar < soglia
                  - entity: automation.casa_nonna_on_solar
                    name: ON Solar > soglia
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.batterie_garage_voltmeter
                    name: Batterie
                title: Batterie
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.casa_nonna_power
                    name: Consumi
                title: Casa Nonna
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.dc_garage
                    name: Dc Garage
                    icon_color: lime
                  - type: custom:mushroom-entity-card
                    entity: sensor.dc_garage_power
                    name: Dc power
                    primary_info: state
                    secondary_info: name
                columns: 2
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.casa_nonna_energy
                    name: Charge
                    unit_of_measurement: kWh
                    texttemplate: '%{y}'
                    type: bar
                    statistic: state
                    period: day
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = parseFloat(y.toFixed(2));
                          return value > 5 ? "darkred" : 
                                 value > 4 ? "red" : 
                                 value > 3 ? "darkorange" : 
                                 value > 2 ? "orange" : 
                                 value > 1 ? "purple" : 
                                 value > 0 ? "blue" : "green";
                        })
                layout:
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 12
                          step: hour
                        - count: 1
                          step: day
                        - count: 7
                          step: day
                        - count: 1
                          step: month
                        - count: 3
                          step: month
                        - count: 1
                          step: year
          - type: custom:bubble-card
            card_type: button
            button_type: state
            entity: sensor.batterie_garage_voltmeter
            name: Inverter Garage
            icon: mdi:garage-open-variant
            sub_button:
              - entity: sensor.casa_nonna_power
                show_last_changed: false
                show_state: true
                visibility:
                  - condition: numeric_state
                    entity: switch.casa_nonna
                    above: 5
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#inverter-garage'
            tap_action:
              action: navigate
              navigation_path: '#inverter-garage'
      - type: grid
        cards:
          - type: heading
            heading: New section
          - features:
              - type: light-brightness
            type: tile
            features_position: bottom
            vertical: false
            entity: light.sala_2
          - features:
              - type: light-brightness
            type: tile
            features_position: bottom
            vertical: false
            entity: light.led_1
            name: Camera
          - features:
              - type: toggle
            type: tile
            features_position: bottom
            vertical: true
            entity: switch.ledentrata
            hide_state: true
            name: 'Entrata '
            icon: mdi:led-on
            grid_options:
              columns: 3
              rows: 3
          - features:
              - type: toggle
            type: tile
            features_position: bottom
            vertical: true
            entity: switch.ledentrata
            hide_state: true
            name: 'Entrata '
            icon: mdi:led-on
            grid_options:
              columns: 3
              rows: 3
          - features:
              - style: icons
                type: climate-preset-modes
                preset_modes:
                  - Power 50
                  - Power 75
                  - Power 100
            type: tile
            features_position: bottom
            vertical: false
            entity: climate.ac_sala_wifi
            name: Sala
            grid_options:
              columns: 9
              rows: 2
            show_entity_picture: false
          - type: tile
            features_position: bottom
            vertical: true
            entity: switch.ac_sala_wifi_high_power_mode
            grid_options:
              columns: 3
              rows: 2
            name: High
            icon: mdi:fan-speed-3
          - features:
              - type: toggle
            type: tile
            features_position: bottom
            vertical: true
            entity: switch.ledentrata
            hide_state: true
            name: 'Entrata '
            icon: mdi:led-on
            grid_options:
              columns: 3
              rows: 3
          - type: custom:apexcharts-card
            graph_span: 1d
            header:
              show: true
              title: Nonna
              show_states: true
              colorize_states: true
            apex_config:
              legend:
                show: false
            series:
              - entity: sensor.nonna_temp_temperature
                name: Today
                show:
                  extremas: true
              - entity: sensor.nonna_temp_temperature
                offset: '-1d'
                name: Yesterday
              - entity: sensor.nonna_temp_temperature
                offset: '-2d'
                name: 2 Days ago
                color: yellow
      - type: grid
        cards:
          - type: heading
            heading: New section
  - type: sections
    max_columns: 4
    title: Pop up
    path: pop-up
    sections:
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: pop-up
                hash: '#boiler'
                name: Boiler
                icon: mdi:water-boiler
                card_layout: large
                button_type: state
                entity: sensor.boiler_status
                show_attribute: false
                tap_action:
                  action: none
                show_last_changed: true
                columns: 4
                rows: 4
                width_desktop: 860px
                bg_opacity: '80'
                bg_blur: '15'
                margin: 2px
              - type: custom:bubble-card
                card_type: button
                button_type: state
                tap_action:
                  action: navigate
                  navigation_path: '#kitchen'
                sub_button: []
                button_action:
                  double_tap_action:
                    action: toggle
                name: Power
                icon: mdi:power
                show_attribute: false
                show_last_changed: true
                entity: switch.boiler
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.boiler_total_on_duration
                sub_button:
                  - entity: sensor.boiler_heat_pump_duration
                    name: P
                    show_name: true
                    show_state: true
                    icon: mdi:pump
                  - entity: sensor.boiler_pump_resistance_duration
                    show_state: true
                    show_name: true
                    name: P & R
                    icon: mdi:air-filter
                  - entity: sensor.boiler_resistance_duration
                    show_state: true
                    show_name: true
                    name: R
                    icon: mdi:resistor
                name: Duration
              - type: custom:bar-card
                style: |-
                  bar-card-value {
                    margin-right: auto;
                    font-size: 20px;
                    font-weight: bold;
                    text-shadow: 1px 1px #0005;
                  }
                positions:
                  indicator: outside
                  name: inside
                animation:
                  state: 'true'
                  speed: 3
                severity:
                  - color: Orange
                    from: 650
                    to: 1200
                  - color: Red
                    from: 1200
                    to: 2000
                  - color: Green
                    from: 0
                    to: 850
                  - hide: null
                    from: -5
                    to: 5
                entities:
                  - entity: sensor.boiler_power
                    name: Boiler
                    max: '1800'
                    icon: mdi:water-boiler
              - type: history-graph
                entities:
                  - entity: switch.boiler
                    name: 'On'
                  - entity: sensor.boiler_status
                    name: Status
              - type: custom:plotly-graph
                entities:
                  - entity: sensor.boiler_power
                logarithmic_scale: false
                hours_to_show: 16
                refresh_interval: 10
                autorange_after_scroll: true
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 3
                          step: hour
                        - count: 16
                          step: hour
                        - count: 36
                          step: hour
                        - count: 5
                          step: day
              - square: false
                type: grid
                cards:
                  - type: statistic
                    period:
                      calendar:
                        period: day
                    stat_type: change
                    name: Day
                    entity: sensor.boiler_energy
                    icon: mdi:view-day-outline
                  - type: statistic
                    period:
                      calendar:
                        period: week
                    stat_type: change
                    name: Week
                    icon: mdi:calendar-week
                    entity: sensor.boiler_energy
                  - type: statistic
                    period:
                      calendar:
                        period: month
                    stat_type: change
                    name: Month
                    icon: mdi:calendar-month
                    entity: sensor.boiler_energy
                columns: 3
              - type: custom:plotly-graph
                hours_to_show: 31d
                title: Energy
                refresh_interval: auto
                entities:
                  - entity: sensor.boiler_energy
                    name: Daily
                    unit_of_measurement: kWh
                    type: bar
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - map_y: parseFloat(y.toFixed(2))
                    marker:
                      color: |-
                        $ex ys.map(y => {
                          let value = y;
                          return value > 4 ? "darkred" : 
                                 value > 3? "red" : 
                                 value > 2 ? "darkorange" : 
                                 value > 6 ? "orange" : 
                                 value > 0 ? "blue" : "green";
                        })
                  - entity: sensor.boiler_energy
                    name: Avg
                    unit_of_measurement: kWh
                    type: line
                    statistic: state
                    period: day
                    filters:
                      - resample: 1d
                      - delta
                      - sliding_window_moving_average: 7
                      - map_y: parseFloat(y.toFixed(2))
                    line:
                      color: yellow
                      width: 2
                layout:
                  height: 500
                  xaxis:
                    rangeselector:
                      'y': 1.2
                      buttons:
                        - count: 7
                          step: day
                        - count: 30
                          step: day
                        - count: 90
                          step: day
                        - count: 6
                          step: month
                        - count: 1
                          step: year
  - type: sections
    max_columns: 4
    title: Popup 2
    path: popup-2
    sections:
      - type: grid
        cards:
          - type: heading
            heading: New section
